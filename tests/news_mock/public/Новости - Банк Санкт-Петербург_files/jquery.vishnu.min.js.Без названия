//release 20180614-1518

!function(t){var i=t.fn.vishnu&&t.fn.vishnu.preemptiveConfig;if(t.fn.vishnu=function(i){return"string"==typeof i&&!t.fn.vishnu.methods[i]||!i||"object"==typeof i?t.fn.vishnu.methods.init.apply(this,arguments):t.fn.vishnu.methods[i]?t.fn.vishnu.methods[i].apply(this,Array.prototype.slice.call(arguments,1)):void t.error("\u041c\u0435\u0442\u043e\u0434 \u0441 \u0438\u043c\u0435\u043d\u0435\u043c "+i+" \u043d\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442")},i){t.fn.vishnu.preemptiveConfig=i;var n=function(t){return i&&i.handlers&&i.handlers[t]},e=n("onGetBaseUrl"),s=n("onGetRevision"),h=n("onGetImagesDir"),a=n("onGetScriptsDir")}t.fn.vishnu._internalSettings={imagesDir:"i/",scriptsDir:"",defaultBaseUrl:"."},t.fn.vishnu.resourcesProvider={getBaseUrl:function(t){var i=e&&e();return"string"==typeof i?i:t},getRevision:function(){var t=s&&s();return t?"?"+t:""},getScriptsDir:function(){return a&&a()||t.fn.vishnu._internalSettings.scriptsDir},getImagesDir:function(){return h&&h()||t.fn.vishnu._internalSettings.imagesDir},getScriptsBaseUrl:function(t){var i=this.getBaseUrl(t);return i&&i+this.getScriptsDir()},getCorrectUrl:function(t,i){return this.getBaseUrl(i)+t+this.getRevision()},getCorrectImageUrl:function(t,i){return this.getBaseUrl(i)+"/"+this.getImagesDir()+t+this.getRevision()},getCorrectScriptUrl:function(t,i){return this.getScriptsBaseUrl(i)+t+this.getRevision()}},t.fn.vishnu.loader=null,t.fn.vishnu.settings={_default:{debugMode:!1,Tracker:{},Model:{},View:{},Cookie:{},Storage:{},Net:{Socket:{}},Rate:{enabled:!1},History:{enabled:!1},LiveChat:{enabled:!1},Logger:{enabled:!0}}},t.fn.vishnu.methods={init:function(i){return this.each(function(){var n=t(this);if(!n.data("vishnu")){var e=new t.fn.vishnu.Vishnu(n);e.init(i),t(this).data("vishnu",{target:n,vishnu:e})}})},show:function(){return this.each(function(){var i=t(this).data("vishnu");i&&i.vishnu&&i.vishnu.show()})},hide:function(){return this.each(function(){var i=t(this).data("vishnu");i&&i.vishnu&&i.vishnu.hide()})},action:function(i){return this.each(function(){var n=t(this).data("vishnu");n&&n.vishnu&&n.vishnu.action(i)})},destroy:function(){return this.each(function(){var i=t(this),n=i.data("vishnu");n&&n.vishnu&&(t(n.vishnu.Target).unbind(),t(n.vishnu.Target).html("")),i.removeData("vishnu")})}},t.fn.vishnu.instancesCount=0,t.fn.vishnu.VishnuEvent={INIT:"vishnu-init",SHOW:"vishnu-show",HIDE:"vishnu-hide",DRAW:"vishnu-draw",RESPONSE:"vishnu-response",INACTIVE:"vishnu-inactive",CLICK:"vishnu-mouse-click",MOUSE_MOVE:"vishnu-mouse-move",ACTION:"vishnu-action",RATE:"vishnu-rate",RATING_SENT:"vishnu-rating-sent",USER_ACTIVITY:"vishnu-user-activity",RATING_RESPONSE:"vishnu-rating-response",REQUEST:"vishnu-request",LINK_CLICK:"vishnu-link-click",LINK_TRACK:"vishnu-link-track",HISTORY_LOADED:"vishnu-history-loaded",MODE_CHANGE:"vishnu-mode-change",REQUIRES_OPERATOR:"vishnu-requires-operator",LIVE_CHAT_EVENT:"vishnu-live_chat-event",LIVE_CHAT_REQUEST:"vishnu-live_chat-request",LIVE_CHAT_RESPONSE:"vishnu-live_chat-response",LIVE_CHAT_TICKET:"vishnu-live_chat-ticket",LIVE_CHAT_INF:"vishnu-live_chat-switch-to-inf",LIVE_CHAT_OPERATOR:"vishnu-live_chat-switch-to-operator",LIVE_CHAT_TYPING:"vishnu-live_chat-typing",LIVE_CHAT_STATE:"vishnu-live_chat-state"},t.fn.vishnu.VishnuModes={LIVE_CHAT:0,INF:1},t.fn.vishnu.Vishnu=function(i){this.Target=i,this.number=++t.fn.vishnu.instancesCount},t.fn.vishnu.Vishnu.prototype={number:null,Target:null,Tracker:null,Model:null,View:null,Net:null,Cookie:null,Storage:null,History:null,LiveChat:null,Logger:null,debugMode:!1,startTime:!1,init:function(i){this.startTime=(new Date).getTime();var n=null;if("string"==typeof i&&36===i.length?n=i:"object"==typeof i&&i.Model&&i.Model.uuid?n=i.Model.uuid:t.fn.vishnu.uuid&&(n=t.fn.vishnu.uuid),n){var e=this.mergeSettings(t.fn.vishnu.settings._default,t.fn.vishnu.settings[n]?t.fn.vishnu.settings[n]:{});"object"==typeof i&&(e=this.mergeSettings(e,i)),e.Model.uuid||(e.Model.uuid=n),this.debugMode=e.debugMode,this.getCookie().init(e.Cookie),this.getStorage().init(e.Storage),this.getTracker().init(e.Tracker),this.factoryNet(e.Net),this.getView().init(e.View),this.getModel().init(e.Model),e.Rate.enabled&&this.getRate().init(e.Rate),e.History.enabled&&this.getHistory().init(e.History),e.LiveChat.enabled&&this.getLiveChat().init(e.LiveChat),e.Logger.enabled&&this.getLogger().init(e.Logger),this.getView().draw()}},factoryNet:function(i){switch(i.type){case t.fn.vishnu.ConnectionType.SYNC:this.log("NET: Sync Connect (GET)"),this.Net=t.extend({},t.fn.vishnu.SyncConnect);break;case t.fn.vishnu.ConnectionType.ASYNC:this.log("NET: Async Connect"),this.Net=t.extend({},t.fn.vishnu.AsyncConnect);break;case t.fn.vishnu.ConnectionType.SYNCPOST:this.Net=t.extend({},t.fn.vishnu.SyncConnectPOST),this.log("NET: Sync Connect (POST)")}this.Net&&this.Net.init(i)},mergeSettings:function(i,n){return t.extend(!0,{},i,n)},show:function(){this.View&&this.View.showVishnu()},hide:function(){this.View&&this.View.hideVishnu()},action:function(t){this.Model&&this.Model.sendUserAction(t)},getTracker:function(){return this.Tracker||(this.Tracker=new t.fn.vishnu.Tracker(this)),this.Tracker},getModel:function(){return this.Model||(this.Model=new t.fn.vishnu.Model(this)),this.Model},getView:function(){return this.View||(this.View=new t.fn.vishnu.View(this)),this.View},getNet:function(){return this.Net||(this.Net=new t.fn.vishnu.Net(this)),this.Net},getCookie:function(){return this.Cookie||(this.Cookie=new t.fn.vishnu.Cookie(this)),this.Cookie},getStorage:function(){return this.Storage||(this.Storage=new t.fn.vishnu.Storage(this)),this.Storage},getRate:function(){return this.Rate||(this.Rate=new t.fn.vishnu.Rate(this)),this.Rate},getHistory:function(){return this.History||(this.History=new t.fn.vishnu.History(this)),this.History},getLiveChat:function(){return this.LiveChat||(this.LiveChat=new t.fn.vishnu.LiveChat(this)),this.LiveChat},getLogger:function(){return this.Logger||(this.Logger=new t.fn.vishnu.Logger(this)),this.Logger},track:function(t){this.Tracker.track(t)},log:function(t){this.debugMode&&"undefined"!=typeof console&&void 0!==console.log&&console.log(t)},on:function(t,i){this.Target&&this.Target.on(t,i)},trigger:function(t,i){this.Target&&(this.log("EVENT: "+t,i),this.Target.trigger(t,i))},getRuntime:function(){for(var t=[0,.25,.5,.75,1,2,5,10],i=(((new Date).getTime()-this.startTime)/1e3).toFixed(2),n=t.length-1;n>=0;n--)if(i>t[n]){i=t[n];break}return i+" sec"}},t.fn.vishnu.Logger=function(t){this.logName="localLog"+t.number,this.Vishnu=t},t.fn.vishnu.Logger.prototype={time:7,logName:"",Vishnu:null,log:null,_idTimer:null,_refreshFreq:2e3,init:function(i){for(var n in i)n in this&&(this[n]=i[n]);var e=this;this.log=this.load(),this.clean(),this.Vishnu.on("__SEND_INIT__ __INIT_RESPONSE__ __SEND_EVENT__ __EVENT_RESPONSE__ __SEND_REQUEST__ __REQUEST_RESPONSE__ __RATE_SEND__ __RATE_RESPONSE__ __SEND_TRACK__",function(t,i){e.composeLog.apply(e,[t,i]),clearTimeout(e._idTimer),e._idTimer=setTimeout(e.save.bind(e),e._refreshFreq)}),t(document).on("vishnu-print-log",function(){console.clear(),console.groupCollapsed("\u041b\u041e\u0413 \u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d \u0432 \u0431\u0443\u0444\u0435\u0440 \u043e\u0431\u043c\u0435\u043d\u0430. \u0412\u0441\u0442\u0430\u0432\u044c\u0442\u0435 \u0435\u0433\u043e \u0432 \u043f\u0438\u0441\u044c\u043c\u043e \u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u044c\u0442\u0435 \u0432 \u041d\u0430\u043d\u043e\u0441\u0435\u043c\u0430\u043d\u0442\u0438\u043a\u0443. ","\u041b\u0438\u0431\u043e \u043c\u043e\u0436\u0435\u0442\u0435 \u0440\u0430\u0441\u043a\u0440\u044b\u0442\u044c \u043b\u043e\u0433 \u043d\u0438\u0436\u0435 \u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0438 \u0432\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0438\u0441\u044c\u043c\u043e:"),console.log(JSON.stringify(e.get())),console.groupEnd();var t=document.createElement("textarea");t.style.position="absolute",t.style.left="-9999px",t.style.top="0",t.id="_hiddenCopyText_",document.body.appendChild(t),t.textContent=JSON.stringify(e.get());document.activeElement;t.focus(),t.setSelectionRange(0,t.value.length);try{document.execCommand("copy")}catch(t){!1}})},clean:function(){var t=this.get(),i=new Date,n=new Date(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()-this.time);for(var e in t)t.hasOwnProperty(e)&&n>Date.parse(e)&&(delete t[e],this.save())},get:function(){return this.log},load:function(){return localStorage.getItem(this.logName)?JSON.parse(localStorage.getItem(this.logName)):{}},composeLog:function(t,i){var n=new Date,e=n.getUTCFullYear()+"-"+(n.getUTCMonth()+1)+"-"+n.getUTCDate(),s=this.log;e in s==!1&&(s[e]={}),s[e][n.getHours()+"-"+n.getMinutes()+"-"+n.getSeconds()]={uuid:this.Vishnu.getModel().getUUID(),cuid:this.Vishnu.getModel().getCUID(),location:location.href,event:t.type,data:i},this.log=s},save:function(){localStorage.setItem(this.logName,JSON.stringify(this.log))}},t.fn.vishnu.Tracker=function(t){this.prefix="vishnu"+t.number+"."},t.fn.vishnu.Tracker.prototype={account:!1,prefix:"",trackCookiePath:null,trackDomainName:null,_ready:!1,init:function(t){for(var i in t)i in this&&(this[i]=t[i]);this.account&&this.account.toString().length&&("undefined"==typeof _gat&&"undefined"==typeof _gaq&&function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(t,i)}(),_gaq="undefined"!=typeof _gaq?_gaq:[],this._ready=!0,this.track(["_setAccount",this.account]),this.postInit(),this.track(["_trackPageview"]))},postInit:function(){this.track(["_setAllowLinker",!0]),"string"==typeof this.trackDomainName?this.track(["_setDomainName",this.trackDomainName]):this.track(["_setDomainName","auto"]),"string"==typeof this.trackCookiePath&&this.track(["_setCookiePath",this.trackCookiePath])},track:function(t){if(this._ready){if("object"==typeof t&&"_trackEvent"===t[0])for(var i=t.length;i<=5;i++)i<5?t[i]=null:5==i&&(t[i]=!0);this.prefix&&"object"==typeof t&&"string"==typeof t[0]&&(t[0]=this.prefix+t[0]),_gaq.push(t)}}},t.fn.vishnu.Cookie=function(t){if(this.prefix="vishnu"+t.number+".",!this.domain){var i=document.domain.split(".");i.length>2&&i.shift(),this.domain=i.join(".")}},t.fn.vishnu.Cookie.prototype={prefix:"",domain:null,init:function(t){for(var i in t)i in this&&(this[i]=t[i])},getCookie:function(t){for(var i=this.prefix+t+"=",n=document.cookie.split(";"),e=0;e<n.length;e++){for(var s=n[e];" "===s.charAt(0);)s=s.substring(1,s.length);if(0===s.indexOf(i))return s.substring(i.length,s.length)}return null},setCookie:function(t,i,n){var e="";if(n){var s=new Date;s.setTime(s.getTime()+24*n*60*60*1e3),e="; expires="+s.toGMTString()}var h=this.domain.split(".");h.length>2&&h.shift(),document.cookie=this.prefix+t+"="+i+e+"; path=/; domain=."+this.domain},hasCookie:function(t){return document.cookie.indexOf(this.prefix+t+"=")>=0}},t.fn.vishnu.ConnectionType={SYNC:"sync",SYNCPOST:"syncPost",ASYNC:"async"},t.fn.vishnu.Net=function(){},t.fn.vishnu.Net.prototype={type:t.fn.vishnu.ConnectionType.SYNC,_handlerInit:null,_handlerResponse:null,_handlerEvent:null,_handlerRate:null,init:function(t){for(var i in t)i in this&&(this[i]=t[i])},onInit:function(t){this._handlerInit=t},onResponse:function(t){this._handlerResponse=t},onEvent:function(t){this._handlerEvent=t},onRate:function(t){this._handlerRate=t},sendInit:function(t,i){},sendRequest:function(t,i,n){},sendEvent:function(t,i,n,e){},sendClick:function(t,i,n){},sendTrack:function(t,i,n){},sendRate:function(t,i,n){}},t.fn.vishnu.SyncConnectPOST={url:"//biz.nanosemantics.ru/api/2.1/json/",init:function(t){for(var i in t)i in this&&(this[i]=t[i])},sendInit:function(t,i,n){var e=this,s=i?{uuid:t,cuid:i}:{uuid:t};n&&"object"==typeof n&&(s.context=n),this.send("Chat.init",s,function(t){t=t&&t.result?t.result:t,e._handlerInit(t)})},sendRequest:function(t,i,n,e){var s=this,h={cuid:i,text:n};e&&"object"==typeof e&&(h.context=e),this.send("Chat.request",h,function(t){t=t&&t.result?t.result:t,s._handlerResponse(t)})},sendEvent:function(t,i,n,e){var s=this,h={cuid:i,euid:n,context:{}};"object"==typeof e&&(h.context=e),this.send("Chat.event",h,function(t){t=t&&t.result?t.result:t,s._handlerEvent(t,n)})},sendClick:function(t,i,n){var e={cuid:i,token:n};this.send("Chat.click",e,function(){})},sendTrack:function(i,n,e){var s;"object"==typeof e&&(s=t.extend(!0,{},{cuid:n,action:"click",arguments:{id:e.linkId,url:e.linkUrl,text:e.linkTxt}}),this.send("Chat.track",s,function(){}))},sendRate:function(t,i,n){var e=this,s={cuid:i,rating:n};this.send("Chat.rate",s,function(t){t=t&&t.result?t.result:t,e._handlerRate(t)})},send:function(i,n,e){var s=this.url+i;t.ajax({type:"POST",url:s,data:t.fn.vishnu.JSON.stringify(n),dataType:"json",success:e})}},t.fn.vishnu.SyncConnectPOST=t.extend({},new t.fn.vishnu.Net,t.fn.vishnu.SyncConnectPOST),t.fn.vishnu.SyncConnect={url:"//biz.nanosemantics.ru/api/2.1/json/",init:function(t){for(var i in t)i in this&&(this[i]=t[i])},sendInit:function(t,i,n){var e=this,s=i?new Array(t,i,null):new Array(t,null,null);n&&s.push(n),this.send("Chat.init",s,function(t){t=t&&t.result?t.result:t,e._handlerInit(t)})},sendRequest:function(i,n,e,s){var h="object"==typeof s?t.extend(!0,{},s):{},a=h?new Array(n,e,h):new Array(n,e),o=this;this.send("Chat.request",a,function(t){t=t&&t.result?t.result:t,o._handlerResponse(t)})},sendEvent:function(t,i,n,e){var s=new Array(i,n,e),h=this;this.send("Chat.event",s,function(t){t=t&&t.result?t.result:t,h._handlerEvent(t,n)})},sendClick:function(t,i,n){var e=new Array(i,n);this.send("Chat.click",e,function(){})},sendTrack:function(i,n,e){var s;if("object"==typeof e){s=t.extend(!0,{},{cuid:n,action:"click",arguments:{id:e.linkId,url:e.linkUrl,text:e.linkTxt}});var h=this.url+"Chat.track";t.ajax({type:"POST",url:h,data:t.fn.vishnu.JSON.stringify(s),dataType:"json"})}},sendRate:function(t,i,n){var e=new Array(i,n),s=this;this.send("Chat.rate",e,function(t){t=t&&t.result?t.result:t,s._handlerRate(t)})},send:function(i,n,e){var s=this.url+i;s+="/"+encodeURIComponent(t.fn.vishnu.JSON.stringify(n)),t.ajax({type:"GET",url:s,dataType:"jsonp",success:e})}},t.fn.vishnu.SyncConnect=t.extend({},new t.fn.vishnu.Net,t.fn.vishnu.SyncConnect),t.fn.vishnu.AsyncConnect={_socket:null,init:function(i){for(var n in i)n in this&&(this[n]=i[n]);var e=this;this._socket=new t.fn.vishnu.Socket,this._socket.init(i.Socket),this._socket.on("init",function(i){i=t.parseJSON(i),e._handlerInit(i)}),this._socket.on("request",function(i){i=t.parseJSON(i),e._handlerResponse(i)}),this._socket.on("event",function(i){i=t.parseJSON(i),e._handlerEvent(i)}),this._socket.on("rate",function(i){i=t.parseJSON(i),e._handlerRate(i)})},sendInit:function(t,i){this._socket.emit("chatInit",{request:{uuid:t,cuid:i,hash:""}})},sendRequest:function(t,i,n){this._socket.send({request:{uuid:t,cuid:i,text:n}})},sendEvent:function(t,i,n,e){this._socket.emit("chatEvent",{request:{uuid:t,cuid:i,euid:n,context:e}})},sendClick:function(t,i,n){this._socket.emit("chatClick",{request:{uuid:t,cuid:i,token:n}})},sendTrack:function(t,i,n){},sendRate:function(t,i,n){this._socket.emit("chatRate",{request:{uuid:t,cuid:i,rating:n}})}},t.fn.vishnu.AsyncConnect=t.extend({},new t.fn.vishnu.Net,t.fn.vishnu.AsyncConnect),t.fn.vishnu.Socket=function(){},t.fn.vishnu.Socket.prototype={host:null,port:8001,scriptLocation:"./socket.io.js",swfLocation:"./WebSocketMain.swf",userHash:"",connect:null,isReady:!1,isConnected:!1,onReadyQueue:[],onConnectQueue:[],init:function(t){for(var i in t)i in this&&(this[i]=t[i]);if("undefined"==typeof io){var n=this;!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=n.scriptLocation;var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(t,i)}()}this._init()},_init:function(){if("undefined"!=typeof io){WEB_SOCKET_SWF_LOCATION=this.swfLocation,this.host||(this.host=location.protocol+"//"+location.hostname),this.connect=new io.connect(this.host,{port:this.port,rememberTransport:!1}),this.connect.on("connect",function(){i.isConnected=!0;var t=null;for(t=i.onConnectQueue.shift();t;){var n=t.shift();i[n].apply(i,t)}}),this.isReady=!0;var t=null;for(t=this.onReadyQueue.shift();t;){this[t.shift()].apply(this,t)}}else{var i=this;setTimeout(function(){i._init()},500)}},on:function(t,i){this.isReady?this.connect.on(t,i):this.onReadyQueue.push(["on",t,i])},once:function(t,i){this.isReady?this.connect.once(t,i):this.onReadyQueue.push(["once",t,i])},emit:function(i,n){n.request.userHash=this.userHash,this.isConnected?this.connect.emit(i,t.fn.vishnu.JSON.stringify(n)):this.onConnectQueue.push(["emit",i,n])},send:function(i){i.request.userHash=this.userHash,this.isConnected?this.connect.send(t.fn.vishnu.JSON.stringify(i)):this.onConnectQueue.push(["send",i])}},t.fn.vishnu.JSON={stringify:function(t){if("object"==typeof window.JSON&&"function"==typeof window.JSON.stringify)return window.JSON.stringify(t);var i=this._objectToJson(t);return i=i.replace(/\t/g,"\\t"),i=i.replace(/\n/g,"\\n"),i=i.replace(/\r/g,"\\r")},_arrayToJson:function(t){var i,n="[";for(i in t)"string"==typeof t[i]?n+='"'+t[i].split('"').join('\\"')+'",':null===t[i]?n+="null,":"object"==typeof t[i]&&null!==t[i]?n+=this._objectToJson(t[i])+",":!isNaN(parseFloat(t[i]))&&isFinite(t[i])&&(n+=t[i]+",");return","===n.charAt(n.length-1)&&(n=n.substr(0,n.length-1)),n+="]"},_objectToJson:function(t){var i,n=!0,e="{";for(i in t)if(isNaN(i)){n=!1;break}if(n)return this._arrayToJson(t);for(i in t)"string"==typeof t[i]?e+='"'+i+'":"'+t[i]+'",':"object"==typeof t[i]?e+='"'+i+'":'+this._objectToJson(t[i])+",":!isNaN(parseFloat(t[i]))&&isFinite(t[i])&&(e+='"'+i+'":'+t[i]+",");return","===e.charAt(e.length-1)&&(e=e.substr(0,e.length-1)),e+="}"}},t.fn.vishnu.Event=function(){this.Counter={},this.Counter[this.INACTIVE]=0,this.Counter[this.CLICK]=0,this.Counter[this.MOUSE]=0},t.fn.vishnu.Event.prototype={READY:"00b2fcbe-f27f-437b-a0d5-91072d840ed3",MOUSE:"6819087d-a7d0-4c67-acd4-47d40b233cc9",INACTIVE:"29e75851-6cae-44f4-8a9c-f6489c4dca88",CLICK:"d825476d-bc08-4038-9ecf-e6b2b267c7b8",ACTION:"132d778f-099b-4fbe-a765-4014136ee970",OPERATOR:"53b6fcbe-f57f-447b-a0d5-91043d840ed2",Counter:null,timer:0,callbackInactive:null,timeout:0,_timerId:null,reset:function(t){this.Counter[t]=0},initInactiveTimer:function(t,i){t&&(this.callbackInactive=t),i&&(this.timeout=i);var n=this;this._timerId=window.setInterval(function(){n._incTimer()},1e3)},clearInactiveTimer:function(){this.timer=0},destroyInactiveTimer:function(){window.clearInterval(this._timerId)},_incTimer:function(){this.timer++,"function"==typeof this.callbackInactive&&this.timeout&&1e3*this.timer>=this.timeout&&this.callbackInactive()}},t.fn.vishnu.Model=function(t){this.Vishnu=t},t.fn.vishnu.Model.prototype={Vishnu:null,Cookie:null,Storage:null,Net:null,History:null,Event:null,uuid:"",cuid:"",params:null,paramsInit:null,initData:null,initAlreadySended:!1,randomInactiveEnabled:!1,_inactive:[],init:function(i){for(var n in i)n in this&&(this[n]=i[n]);this.Cookie||(this.Cookie=this.Vishnu.getCookie()),this.Storage||(this.Storage=this.Vishnu.getStorage()),this.Net||(this.Net=this.Vishnu.getNet()),this.History||(this.History=this.Vishnu.getHistory()),this.Event||(this.Event=new t.fn.vishnu.Event);var e=this;this.Net.onInit(function(t){e.onInit(t)}),this.Net.onResponse(function(t){e.onResponse(t)}),this.Net.onEvent(function(t,i){e.onEventResponse(t,i)}),this.Net.onRate(function(t){e.onRateResponse(t)}),this.Vishnu.on(t.fn.vishnu.VishnuEvent.REQUEST,function(i,n){e.mode()===t.fn.vishnu.VishnuModes.INF&&e.sendRequest(n)}),this.Vishnu.on(t.fn.vishnu.VishnuEvent.LINK_CLICK,function(t,i){e.sendClick(i)}),this.Vishnu.on(t.fn.vishnu.VishnuEvent.LINK_TRACK,function(t,i){e.Net.sendTrack(e.getUUID(),e.getCUID(),i)});var s=this,h=this,a=this.Vishnu.getView();this.Vishnu.on(t.fn.vishnu.VishnuEvent.SHOW,function(i){if(!e.initAlreadySended){if(h.paramsInit)h.Net.sendInit(h.getUUID(),h.getCUID(),h.paramsInit),h.Vishnu.trigger("__SEND_INIT__",h.paramsInit);else{var n={};void 0!==h.paramsInit&&(n=t.extend(!0,{},n,h.paramsInit)),h.params&&h.params.hasOwnProperty("vars")&&void 0!==h.params.vars&&(n=t.extend(!0,{},n,h.params.vars)),h.Net.sendInit(h.getUUID(),h.getCUID(),n),h.Vishnu.trigger("__SEND_INIT__",n)}e.initAlreadySended=!0}a.hideAuto&&(s.hideEvent||(s.hideEvent=new t.fn.vishnu.Event),s.hideEvent.initInactiveTimer(function(){t(a.idInput,a.container).is(":focus")?s.hideEvent.clearInactiveTimer():(a.hideVishnu(),s.hideEvent.destroyInactiveTimer())},a.hideTimeout))}),a.hideAuto&&(this.Vishnu.on(t.fn.vishnu.VishnuEvent.USER_ACTIVITY,function(){s.hideEvent.clearInactiveTimer()}),this.Vishnu.on(t.fn.vishnu.VishnuEvent.REQUEST,function(){s.hideEvent.clearInactiveTimer()}),this.Vishnu.on(t.fn.vishnu.VishnuEvent.RESPONSE,function(){s.hideEvent.clearInactiveTimer()}),this.Vishnu.on(t.fn.vishnu.VishnuEvent.RATE,function(){s.hideEvent.clearInactiveTimer()}),this.Vishnu.on(t.fn.vishnu.VishnuEvent.HIDE,function(){s.hideEvent.clearInactiveTimer()}))},onInit:function(i){return this.Vishnu.trigger("__INIT_RESPONSE__",i),i&&i.cuid?(this.initData=i,this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.INIT,i),this.getCUID()!==i.cuid&&this.Cookie.setCookie("new_chat",1,365),this.setCUID(i.cuid),this.initEvents(),this.sendEvent(this.Event.READY),this.Vishnu.track(["_trackEvent","Inf","Load",this.Vishnu.getRuntime()]),!0):(this.Vishnu.track(["_trackEvent","Error","Init"]),this.Vishnu.log("Empty CUID"),!1)},getUUID:function(){return this.uuid},getCUID:function(){return this.cuid||(this.cuid=this.Cookie.getCookie("cuid")),this.cuid},setCUID:function(t){this.Cookie.setCookie("cuid",t,365),this.cuid=t},mode:function(i){void 0!==this._currentMode&&null!==this._currentMode||(null===(i=this.Vishnu.Cookie.getCookie("mode"))&&(i=t.fn.vishnu.VishnuModes.INF),i*=1);var n=this._currentMode;if(void 0===i)return n;if((i*=1)===n)return n;this._currentMode=i;var e=this.modeName(this._currentMode);return this.Vishnu.log("MODE: \u041f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0438\u043b\u0438\u0441\u044c \u043d\u0430 \u0440\u0435\u0436\u0438\u043c "+e),this.Vishnu.Cookie.setCookie("mode",this._currentMode),this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.MODE_CHANGE,{mode:this._currentMode,modeName:e}),n},modeName:function(i){void 0===i&&(i=this.mode());for(var n in t.fn.vishnu.VishnuModes)if(t.fn.vishnu.VishnuModes.hasOwnProperty(n)&&i===t.fn.vishnu.VishnuModes[n])return n;return"UNDECLARED"},initEvents:function(){for(var i=1;i<=this.initData.events[this.Event.INACTIVE].maxcount;i++)void 0!==this._inactive[i]&&null!==this._inactive[i]||this._inactive.push(i);if(this.randomInactiveEnabled){!function(t){for(var i,n,e=t.length;e;i=parseInt(Math.random()*e),n=t[--e],t[e]=t[i],t[i]=n);}(this._inactive)}if(this.initData&&this.initData.events&&this.initData.events[this.Event.INACTIVE]&&this.initData.events[this.Event.INACTIVE].enabled){var n=this;this.INC||(this.INC=new t.fn.vishnu.Event),this.INC.initInactiveTimer(function(){n.eventInactive()},this.initData.events[this.Event.INACTIVE].timeout)}else this.INC||(this.INC=new t.fn.vishnu.Event),this.INC.initInactiveTimer()},sendEvent:function(t,i){this.Vishnu.trigger("__SEND_EVENT__",{euid:t,context:i}),this.Net.sendEvent(this.getUUID(),this.getCUID(),t,i),this.Event.READY!==t&&this.Vishnu.track(["_trackEvent","Inf","Event"])},sendRequest:function(t,i){this.Vishnu.trigger("__SEND_REQUEST__",{text:t,context:i}),this.Event.clearInactiveTimer(),void 0!==i&&i&&"object"==typeof i?this.Net.sendRequest(this.getUUID(),this.getCUID(),t,i):this.Net.sendRequest(this.getUUID(),this.getCUID(),t),this.Vishnu.track(["_trackEvent","Inf","Request"])},onEventResponse:function(t,i){return this.Vishnu.trigger("__EVENT_RESPONSE__",{euid:i,data:t}),this.onResponse(t,!0,i)},onRateResponse:function(i){this.Vishnu.trigger("__RATE_RESPONSE__",{data:i}),null!==i.cuid&&this.getCUID()!==i.cuid&&this.setCUID(i.cuid),this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.RATING_RESPONSE,i)},onResponse:function(i,n,e){if(this.Vishnu.trigger("__REQUEST_RESPONSE__",{data:i,euid:e,isEvent:n}),i){null!==i.cuid&&this.getCUID()!==i.cuid&&this.setCUID(i.cuid),i.isEvent=void 0!==n&&n,i.euid=e;this.mode();this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.RESPONSE,i)}else this.Vishnu.track(["_trackEvent","Error","Bad response"])},sendClick:function(t){this.Net.sendClick(this.getUUID(),this.getCUID(),t)},eventInactive:function(){t(this.Vishnu.getView().container).hasClass("vishnu-input-block")||(this.INC.Counter[this.Event.INACTIVE]++,this.INC.Counter[this.Event.INACTIVE]<=this.initData.events[this.Event.INACTIVE].maxcount&&this.Vishnu.getView().visible&&!this.Vishnu.getView().stop_announce&&this.mode()===t.fn.vishnu.VishnuModes.INF&&(this.sendEvent(this.Event.INACTIVE,{count:this._inactive[this.INC.Counter[this.Event.INACTIVE]-1]}),this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.INACTIVE,this.INC.Counter[this.Event.INACTIVE])),this.INC.clearInactiveTimer())},eventClick:function(){if(this.initData&&this.initData.events&&this.initData.events[this.Event.CLICK]&&this.initData.events[this.Event.CLICK].enabled&&!(this.Event.timer<2)){this.resetTimerClick&&window.clearTimeout(this.resetTimerClick);var i=this;this.resetTimerClick=window.setTimeout(function(){i.Event.reset(i.Event,i.Event.CLICK)},this.initData.events[this.Event.CLICK].resetTimeout),this.Event.Counter[this.Event.CLICK]++,this.Event.Counter[this.Event.CLICK]>this.initData.events[this.Event.CLICK].maxcount&&(this.Event.Counter[this.Event.CLICK]=1),this.sendEvent(this.Event.CLICK,{count:this.Event.Counter[this.Event.CLICK]}),this.Event.clearInactiveTimer(),this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.CLICK,this.Event.Counter[this.Event.CLICK])}},eventMouse:function(){if(this.initData&&this.initData.events&&this.initData.events[this.Event.MOUSE]&&this.initData.events[this.Event.MOUSE].enabled&&!(this.Event.timer<2)){this.resetTimerMouse&&window.clearTimeout(this.resetTimerMouse);var i=this;this.resetTimerMouse=window.setTimeout(function(){i.Event.reset(i.Event,i.Event.MOUSE)},this.initData.events[this.Event.MOUSE].resetTimeout),this.Event.Counter[this.Event.MOUSE]++,this.Event.Counter[this.Event.MOUSE]>this.initData.events[this.Event.MOUSE].maxcount&&(this.Event.Counter[this.Event.MOUSE]=1),this.sendEvent(this.Event.MOUSE,{count:this.Event.Counter[this.Event.MOUSE]}),this.Event.clearInactiveTimer(),this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.MOUSE_MOVE,this.Event.Counter[this.Event.MOUSE])}},sendUserAction:function(i){this.sendEvent(this.Event.ACTION,i),this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.ACTION,i)},sendRate:function(i){this.Vishnu.trigger("__RATE_SEND__",{rating:i}),this.Net.sendRate(this.getUUID(),this.getCUID(),i),this.Vishnu.track(["_trackEvent","Inf","Rate",i]),this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.RATING_SENT,i)}},t.fn.vishnu.View=function(t){this.Vishnu=t},t.fn.vishnu.View.prototype={Vishnu:null,Cookie:null,Storage:null,History:null,template:'<div id="vishnu-view"></div><div id="vishnu-close"></div><div id="vishnu-response"><div id="vishnu-response-wrap"><div id="vishnu-response-text"></div></div></div><div id="vishnu-request"><textarea id="vishnu-input" maxlength="1000" spellcheck="false"></textarea><input id="vishnu-speech" type="text" speech="speech" x-webkit-speech="x-webkit-speech" x-webkit-grammar="builtin:translate" size="1" lang="ru" tabindex="-1"><button id="vishnu-send"></button></div>',idView:"#vishnu-view",idSend:"#vishnu-send",idInput:"#vishnu-input",idClose:"#vishnu-close",idRate:"#vishnu-rate",idButton:"#vishnu-button",idRequest:"#vishnu-request",idResponseText:"#vishnu-response-text",idSpeech:"#vishnu-speech",classUserMessage:".vishnu-user-message",classInfMessage:".vishnu-inf-message",container:null,callbacks:null,baseUrl:t.fn.vishnu.resourcesProvider.getBaseUrl(t.fn.vishnu._internalSettings.defaultBaseUrl),noCharacter:!1,flashAvailable:!1,flashSrc:"",flashID:"vishnu-flash",animationMask:t.fn.vishnu.resourcesProvider.getImagesDir()+"anim_#.png",animationTimer:null,animationDurations:{},defaultAnimationDuration:1e3,smoothAnimation:!1,smoothDuration:100,gagsEnabled:!1,gagTimer:null,gagTimeout:4e4,gagAnimations:[],visible:!1,defaultInputText:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u0432\u043e\u0439 \u0432\u043e\u043f\u0440\u043e\u0441",firstRequest:!0,flagStopAnnounce:!1,hideAuto:!1,hideTimeout:18e4,init:function(i){try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash")&&(this.flashAvailable=!0)}catch(t){this.flashAvailable=null!==navigator.plugins&&navigator.plugins["Shockwave Flash"]&&navigator.plugins["Shockwave Flash"].description.split(" ")[2].split(".")[0]>=9}this.Cookie||(this.Cookie=this.Vishnu.getCookie()),this.Storage||(this.Storage=this.Vishnu.getStorage()),this.History||(this.History=this.Vishnu.getHistory()),this.container||(this.container=this.Vishnu.Target),this.flashID+=this.Vishnu.number;for(var n in i)n in this&&(this[n]=i[n]);this.Storage.visibilityKey?this.visible=localStorage.hasOwnProperty(this.Storage.visibilityKey)?"true"==localStorage.getItem(this.Storage.visibilityKey):this.visible:this.visible=this.Cookie.hasCookie("visible")?parseInt(this.Cookie.getCookie("visible")):this.visible;var e=this;this.Vishnu.on(t.fn.vishnu.VishnuEvent.RESPONSE,function(t,i){e.setResponseText(i.text.value,i,i.isEvent)})},isFlashEnabled:function(){return this.flashAvailable&&this.flashSrc},draw:function(){this.container.html(this.template),this.noCharacter||t(this.idView,this.container).html(this.getAnimationBox());var i=this;t(this.idView,this.container).mousemove(function(){i.Vishnu.getModel().eventMouse()}).click(function(){i.Vishnu.getModel().eventClick()}),t(this.idSend,this.container).click(function(){i._sendRequest()});var n=this.defaultInputText;t(this.idInput,this.container).keypress(function(e){if(t(this).val()===n&&(t(this).val(""),t(this).removeClass("vishnu-placeholder-default")),13===e.keyCode){e.preventDefault(),i._sendRequest();var s=t(this);setTimeout(function(){s.click()},10)}return i.Vishnu.trigger(t.fn.vishnu.VishnuEvent.USER_ACTIVITY),t(this).val().length<=t(this).attr("maxlength")}).val(n).addClass("vishnu-placeholder-default").click(function(){t(this).val()===n&&(t(this).val(""),t(this).removeClass("vishnu-placeholder-default"))}).blur(),t(this.idInput,this.container).on("blur",function(i){""===t(this).val()&&t(this).addClass("vishnu-placeholder-default").val(n).blur()}),t(this.idClose,this.container).click(function(){i.hideVishnu()}),t(this.idButton).click(function(){i.visible?i.hideVishnu():i.showVishnu()}),this.gagsEnabled&&(this.gagTimer=window.setTimeout(function(){i._playGag()},this.gagTimeout)),this.isFlashEnabled()&&(navigator.userAgent.indexOf("YaBrowser")>-1||navigator.userAgent.indexOf("OPR")>-1)?this.container.css("opacity",1):this.isFlashEnabled()&&navigator.userAgent.indexOf("Chrome")>-1&&this.container.css("opacity",.99),void 0!==document.createElement("input").webkitSpeech&&t(this.idSpeech,this.container).on("speechchange",function(){i._onSpeechChange(this.value)}).on("webkitspeechchange",function(){i._onSpeechChange(this.value)}).hide().val("").show(),this.visible?this.showVishnu(!0):(this.container.hide(),t(this.idButton).data("vishnu-is-visible",0)),this.addMarkListeners(),this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.DRAW)},isText:function(t){return!new RegExp("^\\s*$","").test(t)&&void 0!==t},_sendRequest:function(){if(!t(this.container).hasClass("vishnu-input-block")){var i=t(this.idInput,this.container).attr("maxlength")||1e3,n=t(this.idInput,this.container).val().substr(0,i);this.isText(n)&&n!==this.defaultInputText&&(this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.REQUEST,n.split('"').join("'")),t(this.idInput,this.container).hide().val("").show().focus(),setTimeout(function(){t(this.idInput,this.container).focus()},10))}},_onSpeechChange:function(i){this.isText(i)&&t(this.idInput,this.container).val(i)},getFlashVersion:function(){try{try{var t=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");try{t.AllowScriptAccess="always"}catch(t){return"6.0.0"}}catch(t){}return new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version").replace(/\D+/g,".").match(/^\.?(.+)\.?$/)[1]}catch(t){try{if(navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin)return(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]).description.replace(/\D+/g,".").match(/^\.?(.+)\.?$/)[1]}catch(t){}}return"0.0.0"},getAnimationBox:function(){return this.isFlashEnabled()?'<object id="'+this.flashID+'" name="'+this.flashID+'" width="100%" height="100%" type="application/x-shockwave-flash" data="'+this.getFlashSource()+'"><param name="wmode" value="transparent"/><param name="allowScript" value="always"/><param name="allowScriptAccess" value="always"/><param name="flashVars" value="playAnimation=playAnimation"/><param name="movie" value="'+this.getFlashSource()+'"/></object>':this.getAnimationImg(0)},getFlash:function(){return window[this.flashID]?window[this.flashID]:document[this.flashID]},getAnimationImg:function(i){var n=this.animationMask.replace("#",i);return'<img class="vishnu-img" src="'+t.fn.vishnu.resourcesProvider.getCorrectUrl(n,this.baseUrl)+'" alt="" />'},getAnimationURL:function(i){var n=this.animationMask.replace("#",i);return t.fn.vishnu.resourcesProvider.getCorrectUrl(n,this.baseUrl)},getFlashSource:function(){return t.fn.vishnu.resourcesProvider.getCorrectUrl(this.flashSrc,this.baseUrl)},hideVishnu:function(){this.visible&&(this.container.fadeOut(200),t(this.idButton).removeClass("vishnu-selected"),t(this.idButton).data("vishnu-is-visible",0),this.visible=!1,this.Storage.visibilityKey?localStorage.setItem(this.Storage.visibilityKey,!1):this.Cookie.setCookie("visible",0,365),this.Vishnu.track(["_trackEvent","Inf","Hide"]),this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.HIDE))},showVishnu:function(i){i=void 0!==i&&i,this.visible&&!i||(this.container.fadeIn(200),t(this.idButton).addClass("vishnu-selected"),t(this.idButton).data("vishnu-is-visible",1),this.visible=!0,this.Storage.visibilityKey?localStorage.setItem(this.Storage.visibilityKey,!0):this.Cookie.setCookie("visible",1,365),i||this.Vishnu.track(["_trackEvent","Inf","Show"]),this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.SHOW))},setResponseText:function(i,n,e){var s=this;this.firstRequest&&!e&&(this.firstRequest=!1,this.Cookie.getCookie("new_chat")&&(this.Cookie.setCookie("new_chat","",-1),this.Cookie.setCookie("chat_link","",-1),this.Cookie.setCookie("chat_click","",-1),this.Vishnu.track(["_trackEvent","Inf","Chat"]))),/href="event:/gim.test(i)&&(this.Vishnu.track(["_trackEvent","Inf","Response link show"+(e?" (Event)":"")]),this.Cookie.getCookie("chat_link")||e||(this.Cookie.setCookie("chat_link","1",365),this.Vishnu.track(["_trackEvent","Inf","Chat with link"]))),n.context&&(n.context.stop_announce&&1==n.context.stop_announce&&(this.Vishnu.Model.Event.destroyInactiveTimer(),this.stop_announce=!0),n.context.user_phone&&1==n.context.mcs&&this.Vishnu.track(["_trackEvent","Inf","MCS",n.context.ip_address+" : "+n.user_phone])),i=this.replaceMarks(i,n.token,e),this.setText(i,n),t("<div></div>").html(i).find(".vishnu-click").each(function(){s.Vishnu.track(["_trackEvent","Inf","Link show"+(e?" (Event)":""),t(this).attr("href")])}),this.scrollTop(),n.animation&&n.animation.type&&this.playAnimation(n.animation),n.navigation&&n.navigation.url&&(this.Cookie.setCookie("navigation",1),window.top.location.href=n.navigation.url),n.text&&n.text.status<0&&window.setTimeout(function(){s.hideVishnu()},n.text.delay)},replaceMarks:function(t,i,n){return n=n&&void 0!==n?"vishnu-click-is-event":"",i=i&&void 0!==i?i:"",t.replace(/href="event:/gim,'class="vishnu-click '+n+'" value="'+i+'" href="').replace(/<userlink([^>]*(?!data-request))?(data-request="([^\"]+)?")?>(.*?)<\/userlink>/gim,"<a class='vishnu-userlink'$1 href='#'>$4</a>")},scrollTop:function(){t(this.idResponseText,this.container).scrollTop(0)},addMarkListeners:function(){var i=this,n="vishnu-click-is-event";t(this.idResponseText,this.container).on("click",".vishnu-userlink",function(n){var e=t(this).data().hasOwnProperty("request")?t(this).data("request"):t(this).text();return(t(this).parents(i.classInfMessage+":first").hasClass("vishnu-last-message")||t(this).parents(i.idResponseText+":first").hasClass("vishnu-last-message"))&&(t(this).parents(i.classInfMessage+":first").removeClass("vishnu-last-message"),t(this).parents(i.idResponseText+":first").removeClass("vishnu-last-message"),i.Vishnu.trigger(t.fn.vishnu.VishnuEvent.REQUEST,e),i.Vishnu.track(["_trackEvent","Inf","Userlink click",t(this).text()])),!1}).on("click",".vishnu-click",function(e){var s={linkId:void 0!==t(this).data("linkid")?+t(this).data("linkid"):null,linkTxt:t(this).text(),linkUrl:t(this).attr("href")};null!==s.linkId?(i.Vishnu.trigger(t.fn.vishnu.VishnuEvent.LINK_TRACK,s),i.Vishnu.track(["_trackEvent","Inf","Link TRACK"+(t(this).hasClass(n)?" (Event)":""),t(this).attr("href")])):(i.Vishnu.trigger(t.fn.vishnu.VishnuEvent.LINK_CLICK,t(this).attr("value")),i.Vishnu.track(["_trackEvent","Inf","Link click"+(t(this).hasClass(n)?" (Event)":""),t(this).attr("href")])),i.Cookie.getCookie("chat_click")||(i.Cookie.setCookie("chat_click","1",365),i.Vishnu.track(["_trackEvent","Inf","Chat with click"]))})},setText:function(i,n){this.isText(i)&&t(this.idResponseText,this.container).addClass("vishnu-last-message").html(i)},playAnimation:function(t){if(!this.noCharacter)if(this.isFlashEnabled())try{this.getFlash().playAnimation(t.type)}catch(t){}else this._playAnimation(t.type)},_playAnimation:function(i){if(!this.noCharacter){if(this.animationTimer)return!1;var n=this.animationDurations&&this.animationDurations[i]?this.animationDurations[i]:this.defaultAnimationDuration;this.smoothAnimation?(t(this.idView+" img",this.container).clone().addClass("vishnu-smooth-animation").attr("src",this.getAnimationURL(i)).appendTo(t(this.idView,this.container)).hide(),t(this.idView+" img.vishnulite-smooth-animation",this.container).fadeIn(200)):t(this.idView+" img",this.container).attr("src",this.getAnimationURL(i));var e=this;return this.animationTimer=window.setTimeout(function(){e._stopAnimation()},n),!0}},_stopAnimation:function(){this.animationTimer=null,this.smoothAnimation?t(this.idView+" img.vishnulite-smooth-animation",this.container).fadeOut(200,function(){t(this).remove()}):t(this.idView+" img",this.container).attr("src",this.getAnimationURL(0))},_playGag:function(){if(!this.noCharacter&&(this.gagTimer=null,this.gagAnimations.length)){var t=this.gagAnimations[Math.floor(Math.random()*this.gagAnimations.length)];this.playAnimation({type:t});var i=this;this.gagTimer=window.setTimeout(function(){i._playGag()},i.gagTimeout)}},updateHeight:function(i,n){var e=this;n=void 0!==n?n:10;var s=t(e.idResponseText,e.container),h=parseFloat(t("#vishnu-response",e.container).height())||300,a=parseFloat(t("#vishnu-response",e.container).css("min-height"))||50;h<a&&(h=a),s.css({height:1}),s.css({height:h}),"object"==typeof s.data("jsp")&&(e.throttleTimeout&&clearTimeout(e.throttleTimeout),e.throttleTimeout=setTimeout(function(){s.data("jsp").reinitialise(),i&&void 0!==i&&i.height()>0&&i.height()+10>t(".jspContainer",".vishnu-container").height()?(s.data("jsp").scrollToBottom(n),s.data("jsp").scrollToElement(i,!0,n)):s.data("jsp").scrollToBottom(n),e.throttleTimeout=null},50))}},t.fn.vishnu.Rate=function(t){this.Vishnu=t},t.fn.vishnu.Rate.prototype={Vishnu:null,container:null,view:null,answered:!1,shown:!1,defaultThanksText:"\u0421\u043f\u0430\u0441\u0438\u0431\u043e!",template:'<div id="vishnu-rate"><div id="vishnu-rate-text">\u041f\u043e\u043c\u043e\u0433 \u043b\u0438 \u0432\u0430\u043c \u043e\u0442\u0432\u0435\u0442?</div><div id="vishnu-rate-yes"></div><div id="vishnu-rate-no"></div><div id="vishnu-rate-close"></div><div id="vishnu-rate-thanks"></div><div id="vishnu-rate-details">&mdash; <a href="#" rel="3">\u042f \u0441\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u043b(-\u0430) \u043f\u0440\u043e \u0434\u0440\u0443\u0433\u043e\u0435</a><br />&mdash; <a href="#" rel="2">\u042f \u043d\u0435 \u043f\u043e\u043d\u044f\u043b(-\u0430) \u043e\u0442\u0432\u0435\u0442</a><br />&mdash; <a href="#" rel="1">\u041e\u0442\u0432\u0435\u0442 \u043d\u0435 \u0440\u0435\u0448\u0438\u043b \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u0443</a></div></div>',idRate:"#vishnu-rate",idRateText:"#vishnu-rate-text",idRateClose:"#vishnu-rate-close",idRateYes:"#vishnu-rate-yes",idRateNo:"#vishnu-rate-no",idRateDetails:"#vishnu-rate-details",idRateThanks:"#vishnu-rate-thanks",closeTimeout:5e3,init:function(i){for(var n in i)n in this&&(this[n]=i[n]);var e=this;this.Vishnu.on(t.fn.vishnu.VishnuEvent.RESPONSE,function(t,i){e.process(i)}),this.Vishnu.on(t.fn.vishnu.VishnuEvent.RATE,function(t,i){e.Vishnu.Model.sendRate(i)}),this.Vishnu.on(t.fn.vishnu.VishnuEvent.RATING_RESPONSE,function(t,i){e.showThanks(i)}),this.Vishnu.on(t.fn.vishnu.VishnuEvent.DRAW,function(t){e.draw()})},draw:function(){this.container||(this.container=this.Vishnu.Target),this.container.append(t(this.template));var i=this;t(this.idRateClose,this.container).click(function(){i.close()}),t(this.idRateYes,this.container).click(function(){i.answered||(i.answered=!0,i.Vishnu.trigger(t.fn.vishnu.VishnuEvent.RATE,5))}),t(this.idRateNo,this.container).click(function(){i.answered||(i.Vishnu.track(["_trackEvent","Inf","Rate","No"]),i.showDetails())}),t(this.idRateDetails+" a",this.container).click(function(n){n.preventDefault(),i.answered||(i.answered=!0,i.Vishnu.trigger(t.fn.vishnu.VishnuEvent.RATE,t(this).attr("rel")))})},process:function(t){t.text.showRate?(this.shown&&this.close(),this.show()):this.shown&&this.close()},show:function(){this.shown=!0,this.answered=!1,t(this.idRate,this.container).show(),this.Vishnu.track(["_trackEvent","Inf","Rate","Show"])},close:function(){t(this.idRate,this.container).hide(),t(this.idRateThanks,this.container).html("").hide(),t(this.idRateDetails,this.container).hide(),this.answered=!1,this.shown=!1},showThanks:function(i){text=void 0!==i&&void 0!==i.text&&i.text.value.length>0?i.text.value:this.defaultThanksText,text=this.Vishnu.getView().replaceMarks(text,i.token),i.animation&&i.animation.type&&this.Vishnu.getView().playAnimation(i.animation),t(this.idRateDetails,this.container).is(":visible")&&t(this.idRateDetails,this.container).hide(),t(this.idRateThanks,this.container).html(text).show();var n=this,e=i.token;t(this.idRateThanks,this.container).find(".vishnu-userlink").click(function(){return n.Vishnu.trigger(t.fn.vishnu.VishnuEvent.REQUEST,t(this).text()),n.Vishnu.track(["_trackEvent","Inf","Rate userlink click",t(this).text()]),!1}).end().find(".vishnu-click").click(function(){n.Vishnu.trigger(t.fn.vishnu.VishnuEvent.LINK_CLICK,e),n.Vishnu.track(["_trackEvent","Inf","Rate link click",t(this).attr("href")])}).each(function(){n.Vishnu.track(["_trackEvent","Inf","Rate link show",t(this).attr("href")])}),setTimeout(function(){n.close()},this.closeTimeout)},showDetails:function(){t(this.idRateDetails,this.container).show()}},t.fn.vishnu.History=function(t){this.historyName="vishnu"+t.number+".history",this.Vishnu=t},t.fn.vishnu.History.prototype={length:20,historyName:"",Vishnu:null,useServerStorage:!1,useFlashStorage:!1,useLocalStorage:!1,flashStorageLocation:"./FlashStorage.swf",flashStorageID:"vishnu-flash-storage",history:null,init:function(i){for(var n in i)n in this&&(this[n]=i[n]);if(this.useServerStorage||this.useFlashStorage||this.useLocalStorage){var e=this;this.flashStorageID+=this.Vishnu.number,this.historyName+="["+this.Vishnu.getModel().uuid+"]",this.Vishnu.on(t.fn.vishnu.VishnuEvent.DRAW,function(t){e.draw()}),this.Vishnu.on(t.fn.vishnu.VishnuEvent.REQUEST,function(t,i){e.request(i)}),this.Vishnu.on(t.fn.vishnu.VishnuEvent.RESPONSE,function(t,i){e.response(i)})}},get:function(){return this.history||this.load(),this.history},load:function(){return this.history=this._load(),this.history&&this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.HISTORY_LOADED,[this.history]),this.history},_load:function(){if(this.useFlashStorage&&this.isFlashStorageAvailable())try{return this.parse(decodeURIComponent(this.getFlashStorage().getData(this.historyName)))}catch(t){this.getFlashStorage().setData(this.historyName,"")}if(this.useLocalStorage&&this.isLocalStorageAvailable())try{return this.parse(localStorage.getItem(this.historyName))}catch(t){}return[]},onLoad:function(i){i&&(this.history=t.toArray(t.parseJSON(i))),this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.HISTORY_LOADED,[this.history])},draw:function(){if(this.useFlashStorage){this.container||(this.container=this.Vishnu.Target);var t=this.Vishnu.debugMode?"true":"false",i='<object id="'+this.flashStorageID+'" name="'+this.flashStorageID+'" width="1px" height="1px" type="application/x-shockwave-flash" data="'+this.flashStorageLocation+'"><param name="wmode" value="transparent"/><param name="allowScript" value="always"/><param name="allowScriptAccess" value="always"/><param name="flashVars" value="isDebugger="'+t+'"/><param name="movie" value="'+this.flashStorageLocation+'"/></object>';this.container.append(i)}},request:function(t){var i=this.get();i.push({user:t}),i.length>this.length&&i.splice(0,i.length-this.length),this.save(i)},response:function(t){var i=this.get();i&&i.length>0&&i[i.length-1].inf&&i[i.length-1].inf.replace(/<\/?[^>]+>/g,"")===t.text.value.replace(/<\/?[^>]+>/g,"")||(i.push({inf:t.text.value}),i.length>this.length&&i.splice(0,i.length-this.length),this.save(i))},save:function(i){this.history=i,this.useFlashStorage&&this.isFlashStorageAvailable()&&this.getFlashStorage().setData(this.historyName,encodeURIComponent(t.fn.vishnu.JSON.stringify(i))),this.useLocalStorage&&this.isLocalStorageAvailable()&&localStorage.setItem(this.historyName,t.fn.vishnu.JSON.stringify(i))},clean:function(){this.history=null,this.useFlashStorage&&this.isFlashStorageAvailable()&&this.getFlashStorage().setData(this.historyName,encodeURIComponent(t.fn.vishnu.JSON.stringify({}))),this.useLocalStorage&&this.isLocalStorageAvailable()&&localStorage.setItem(this.historyName,t.fn.vishnu.JSON.stringify({}))},getFlashStorage:function(){return window[this.flashStorageID]?window[this.flashStorageID]:document[this.flashStorageID]},parse:function(i){var n=t.parseJSON(i);if(!("object"==typeof n&&n instanceof Array))throw new Error("\u041d\u0435 \u043f\u043e\u043b\u0443\u0447\u0438\u043b\u043e\u0441\u044c \u0440\u0430\u0441\u043f\u0430\u0440\u0441\u0438\u0442\u044c \u043c\u0430\u0441\u0441\u0438\u0432: "+i);return n},isFlashStorageAvailable:function(){try{return null!==this.getFlashStorage()&&"true"==this.getFlashStorage().available()}catch(t){return!1}},isLocalStorageAvailable:function(){try{return"localStorage"in window&&null!==window.localStorage}catch(t){return!1}}},t.fn.vishnu.LiveChat=function(t){this.Vishnu=t},t.fn.vishnu.LiveChat.prototype={STATE_QUEUE:"queue",STATE_CHATTING:"chatting",STATE_CLOSED_BY_OPERATOR:"closed_by_operator",KIND_VISITOR:"visitor",KIND_OPERATOR:"operator",KIND_OPERATOR_BUSY:"operator_busy",KIND_FORM_RESPONSE:"form_response",eventMessages:{"vishnu-init":{text:"\u0412\u0438\u0434\u0436\u0435\u0442 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d"},"vishnu-inactive":{text:"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043d\u0435 \u043f\u0440\u043e\u044f\u0432\u043b\u044f\u0435\u0442 \u0430\u043a\u0442\u0438\u0432\u043d\u043e\u0441\u0442\u0438, \u0435\u043c\u0443 \u0431\u0443\u0434\u0435\u0442 \u043f\u043e\u043a\u0430\u0437\u0430\u043d \u0430\u043d\u043e\u043d\u0441"},"vishnu-mouse-click":{text:"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043a\u043b\u0438\u043a\u043d\u0443\u043b \u043f\u043e \u0438\u043d\u0444\u0443"},"vishnu-mouse-move":{text:"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043f\u0440\u043e\u0432\u0435\u043b \u043c\u044b\u0448\u043a\u043e\u0439 \u043f\u043e \u0438\u043d\u0444\u0443"},"vishnu-action":{text:"\u0412\u043e\u0437\u043d\u0438\u043a\u043b\u043e \u043a\u0430\u0441\u0442\u043e\u043c\u043d\u043e\u0435 \u0432\u043d\u0435\u0448\u043d\u0435\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435"},"vishnu-rate":{text:"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043e\u0446\u0435\u043d\u0438\u043b \u043e\u0442\u0432\u0435\u0442 \u0438\u043d\u0444\u0430"},"vishnu-link-click":{text:"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043a\u043b\u0438\u043a\u043d\u0443\u043b \u043f\u043e \u0441\u0441\u044b\u043b\u043a\u0435 \u0432 \u043e\u0442\u0432\u0435\u0442\u0435 \u0438\u043d\u0444\u0430"},"vishnu-requires-operator":{text:"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044e \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u043f\u043e\u043c\u043e\u0449\u044c \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u0430"},"vishnu-live_chat-ticket":{text:"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u043b \u0437\u0430\u044f\u0432\u043a\u0443"}},Vishnu:null,Model:null,View:null,params:null,baseUrl:t.fn.vishnu.resourcesProvider.getBaseUrl(t.fn.vishnu._internalSettings.defaultBaseUrl),scriptLocation:"/live.chat.min.js",isInf:1,isLiveChatReady:!1,isInit:!1,isReady:!1,state:null,messageCount:0,lastMessage:null,initAlreadySended:!1,init:function(i){for(var n in i)n in this&&(this[n]=i[n]);var e=this;e.Model=e.Vishnu.getModel(),e.View=e.Vishnu.getView(),e.Vishnu.on(t.fn.vishnu.VishnuEvent.SHOW,function(t){e.initAlreadySended||(e.load(e.getScriptSource(),e.params),e.initAlreadySended=!0)}),e.initEvents()},initEvents:function(){var i=this;this.Vishnu.on(t.fn.vishnu.VishnuEvent.REQUEST,function(t,n){i.sendMessage(n)}),this.Vishnu.on(t.fn.vishnu.VishnuEvent.INACTIVE,function(t,n){i.sendInactive(n)}),this.Vishnu.on(t.fn.vishnu.VishnuEvent.CLICK,function(t,n){i.sendClick(n)}),this.Vishnu.on(t.fn.vishnu.VishnuEvent.MOUSE_MOVE,function(t,n){i.sendMouseMove(n)}),this.Vishnu.on(t.fn.vishnu.VishnuEvent.ACTION,function(t,n){i.sendAction(n)}),this.Vishnu.on(t.fn.vishnu.VishnuEvent.REQUIRES_OPERATOR,function(t,n){i.sendRequiresOperator(n)}),this.Vishnu.on(t.fn.vishnu.VishnuEvent.RATE,function(t,n){i.sendRate(n)}),this.Vishnu.on(t.fn.vishnu.VishnuEvent.LINK_CLICK,function(t,n){i.sendLinkClick(n)}),i.Vishnu.on(t.fn.vishnu.VishnuEvent.LIVE_CHAT_STATE,function(t,n){i.state=n,i.isLiveChatReady||i.STATE_CHATTING!=n&&i.STATE_CLOSED_BY_OPERATOR!=n||i.onLiveChatReady()}),this.Vishnu.on(t.fn.vishnu.VishnuEvent.LIVE_CHAT_RESPONSE,function(t,n){i.onMessage(n)}),this.Vishnu.on(t.fn.vishnu.VishnuEvent.LIVE_CHAT_TYPING,function(n,e){if(i.isReady){if(e){var s=i.isInf;i.isInf=0,i.isLiveChatReady&&s&&i.Vishnu.trigger(t.fn.vishnu.VishnuEvent.LIVE_CHAT_OPERATOR)}i.onTyping(e)}})},sendReady:function(){var i=this.eventMessages[t.fn.vishnu.VishnuEvent.INIT].text;this.sendEvent("Chat.event",i,this.Model.params,this.Model.Event.READY,this.isReady),this.isReady||this.onTyping(!0)},sendInactive:function(i){var n=this.eventMessages[t.fn.vishnu.VishnuEvent.INACTIVE].text;this.sendEvent("Chat.event",n,{count:i},this.Model.Event.INACTIVE)},sendClick:function(i){var n=this.eventMessages[t.fn.vishnu.VishnuEvent.CLICK].text;this.sendEvent("Chat.event",n,{count:i},this.Model.Event.CLICK)},sendMouseMove:function(i){var n=this.eventMessages[t.fn.vishnu.VishnuEvent.MOUSE_MOVE].text;this.sendEvent("Chat.event",n,{count:i},this.Model.Event.MOUSE)},sendAction:function(i){var n=this.eventMessages[t.fn.vishnu.VishnuEvent.ACTION].text;this.sendEvent("Chat.event",n,i,this.Model.Event.ACTION)},sendRequiresOperator:function(i){var n=this.eventMessages[t.fn.vishnu.VishnuEvent.REQUIRES_OPERATOR].text;this.sendEvent("Chat.event",n,i,this.Model.Event.OPERATOR)},sendRate:function(i){var n=this.eventMessages[t.fn.vishnu.VishnuEvent.RATE].text;this.sendEvent("Chat.rate",n,{rate:i})},sendLinkClick:function(i){var n=this.eventMessages[t.fn.vishnu.VishnuEvent.LINK_CLICK].text;this.sendEvent("Chat.click",n,{token:i})},sendEvent:function(i,n,e,s,h){this.isLiveChatReady&&this.isInf&&(this.STATE_CHATTING==this.state||this.STATE_CLOSED_BY_OPERATOR==this.state)&&(data={message:n,event:"chat.for_operator_message",aux:t.fn.vishnu.JSON.stringify({type:i,cuid:this.Model.getCUID(),params:e,euid:s,no_response:h})},"Chat.event"==i&&this.Model.Event.READY!==s&&this.Vishnu.track(["_trackEvent","Inf","Event"]),this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.LIVE_CHAT_EVENT,data))},sendTicket:function(i,n,e,s,h,a){if(this.isLiveChatReady&&e){var o={text:n,event:"chat.form_response",data:t.fn.vishnu.JSON.stringify({formId:i||"",formData:e||null,additionalParams:s||null,visitorShouldSeeTicketId:h||!1}),aux:a||null};this.Vishnu.track(["_trackEvent","inf","Ticket ("+i+")",n]),this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.LIVE_CHAT_TICKET,o)}},sendMessage:function(i,n){this.isLiveChatReady&&(data={message:i,aux:t.fn.vishnu.JSON.stringify({type:"Chat.request",cuid:this.Model.getCUID(),params:n||[]})},this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.LIVE_CHAT_REQUEST,data))},onLiveChatReady:function(i){this.isLiveChatReady||(this.isLiveChatReady=!0,this.isInf||this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.LIVE_CHAT_OPERATOR),this.sendReady())},onInit:function(t){this.isInit||(this.isInit=!0,this.Model.onInit(t))},onReady:function(t){return!this.isReady&&(this.isReady=!0,this.Vishnu.track(["_trackEvent","Inf","Response ready",this.Vishnu.getRuntime()]),!0)},onMessage:function(t){switch(this.lastMessage=t,this.messageCount++,t.kind){case this.KIND_VISITOR:this.onUserMessage(t);break;case this.KIND_OPERATOR:void 0===t.aux?this.onPersonMessage(t):this.onInfMessage(t);break;default:this.onInfoMessage(t)}},onInfoMessage:function(t){this.isReady&&this.View.setText(t.overflow.text)},onUserMessage:function(t){this.View.setText(t.overflow.text),this.isLiveChatReady&&this.isInf&&(this.onTyping(!0),this.Model.Event.clearInactiveTimer())},onPersonMessage:function(i){var n=this.isInf;this.isInf=0,this.isLiveChatReady&&n&&this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.LIVE_CHAT_OPERATOR);this.View.replaceMarks(i.overflow.text);this.View.setText(i.overflow.text)},onInfMessage:function(i){var n=i.aux?t.parseJSON(i.aux):{},e=n.result&&void 0!==n.result?n.result:{},s=!this.isInf;if(this.isInf=1,s&&this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.LIVE_CHAT_INF),"Chat.init"!=n.type){var h="Chat.event"==n.type;if(!h||n.euid!=this.Model.Event.READY||this.onReady(n))if(e.text=e.text&&void 0!==e.text?e.text:{},e.text.value=e.text.value&&void 0!==e.text.value?e.text.value:i.text,e.isEvent=h,this.isLiveChatReady)"Chat.rate"==n.type?this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.RATING_RESPONSE,e):this.Vishnu.trigger(t.fn.vishnu.VishnuEvent.RESPONSE,e);else{var a=this.View.replaceMarks(e.text.value,e.token,h);this.View.setText(a,e)}}else this.onInit(e)},onTyping:function(t){this.View.typing(t)},getScriptSource:function(){return t.fn.vishnu.resourcesProvider.getCorrectScriptUrl(this.scriptLocation,this.baseUrl)},load:function(t,i){void 0===window.webim&&(window.webim={}),i.domain=this.getRealDomain(i.accountName,i.domain);for(var n in i)n&&(window.webim[n]=i[n]);var e=document.createElement("script");e.type="text/javascript",e.src=t,document.getElementsByTagName("head")[0].appendChild(e)},getRealDomain:function(t,i){return t+"."+i}},t.fn.vishnu.Storage=function(t){this.Vishnu=t},t.fn.vishnu.Storage.prototype={Vishnu:null,visibilityKey:null,setItem:null,getItem:null,init:function(t){for(var i in t)i in this&&(this[i]=t[i])},set:function(t,i){this.setItem&&"function"==typeof this.setItem&&this.setItem(t,i)},get:function(t){return!(!this.getItem||"function"!=typeof this.getItem)&&this.getItem(t)},has:function(t){if(this.getItem&&"function"==typeof this.getItem){var i=this.getItem(t);return null!==i&&void 0!==i}return!1}}}("undefined"!=typeof vishnuJQuery?vishnuJQuery:jQuery);