//release 20180614-1518

!function(e){e.fn.vishnu.VishnuEvent.MODE_CHANGE="vishnu-mode-change",e.fn.vishnu.VishnuEvent.SWITCH_TO_OPERATOR_REQUESTED="nns_switchToOperatorRequested",e.fn.vishnu.VishnuEvent.LIVECHAT_STATUS_REQUESTED="nns_livechatStatusRequested",e.fn.vishnu.VishnuEvent.LIVECHAT_SESSION_CREATED="nns_livechatSessionCreated",e.fn.vishnu.VishnuEvent.OPERATOR_PERSON_ASSIGNED="nns_operatorPersonAssigned",e.fn.vishnu.VishnuEvent.QUEUE_TIMED_OUT="nns_queueTimedOut",e.fn.vishnu.VishnuEvent.LOG_TO_OPERATOR_SENT="nns_logToOperatorSent",e.fn.vishnu.VishnuEvent.V3G_LOG_TO_OPERATOR_SENT="v3g_logToOperatorSent",e.fn.vishnu.VishnuEvent.SWITCH_TO_OPERATOR_SUCCESS="nns_switchToOperatorSuccess",e.fn.vishnu.VishnuEvent.USER_TYPED="nns_userTyped",e.fn.vishnu.VishnuEvent.USER_TEXT_SENT="nns_userTextSent",e.fn.vishnu.VishnuEvent.OPERATOR_TYPED="nns_operatorTyped",e.fn.vishnu.VishnuEvent.OPERATOR_TEXT_SENT="nns_operatorTextSent",e.fn.vishnu.VishnuEvent.USER_END_DIALOG="nns_userEndDialog",e.fn.vishnu.VishnuEvent.SWITCH_TO_VISHNU="nns_switchToVishnu",e.fn.vishnu.VishnuEvent.V3G_OPERATOR_CHAT_RATED="v3g_operatorChatRated",e.fn.vishnu.VishnuEvent.OPERATOR_CHAT_RATED="nns_operatorChatRated",e.fn.vishnu.VishnuEvent.OPERATOR_MESSAGE_RATED="nns_operatorMessageRated",e.fn.vishnu.VishnuEvent.FILE_UPLOAD_EXTERNAL_PROCESS="nns_fileUploadExternalProcess",e.fn.vishnu.VishnuEvent.FILE_UPLOADED="nns_fileUploaded",e.fn.vishnu.VishnuEvent.V3G_UPLOAD_EXTERNAL_PROCESS="v3g_logUploadExternalProcess",e.fn.vishnu.VishnuEvent.LOG_UPLOAD_EXTERNAL_PROCESS="nns_logUploadExternalProcess",e.fn.vishnu.VishnuEvent.LOG_UPLOADED="nns_logUploaded",e.fn.vishnu.VishnuEvent.FORM_SHOW="nns_formShow",e.fn.vishnu.LCEModel=function(e){this.Vishnu=e},e.fn.vishnu.LCEModel.prototype={KIND_VISITOR:"visitor",KIND_OPERATOR:"operator",KIND_TEH:"info",Vishnu:null,Model:null,View:null,params:null,baseUrl:e.fn.vishnu.resourcesProvider.getBaseUrl(e.fn.vishnu._internalSettings.defaultBaseUrl),scriptLocation:null,scriptEvAdapterLocation:null,isLiveChatReady:!1,debugIntergtaion:!1,debugIntergtaionTime:2e3,operatorId:null,operatorAvatar:null,operatorName:null,operatorAlredyTyped:!1,dialogId:null,messageId:null,messageCount:0,lastMessage:null,saveTehMessage:!1,transformDesignWidget:!0,sendLogWithRequiresOperator:!0,sendLogWithLCSessionCreate:!1,queueTimeout:3e4,queueTimer:null,restoreSession:!1,idOperatorName:"#vishnu-operatorName",TEHmessage:{noOperators:"\u041a \u0441\u043e\u0436\u0430\u043b\u0435\u043d\u0438\u044e, \u0432\u0441\u0435 \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u044b \u0437\u0430\u043d\u044f\u0442\u044b.",operatorIsTyped:"\u041f\u0435\u0447\u0430\u0442\u0430\u0435\u0442 ",queueTime:"\u041e\u043f\u0435\u0440\u0430\u0442\u043e\u0440 \u043d\u0435 \u0432\u0437\u044f\u043b \u0434\u0438\u0430\u043b\u043e\u0433 \u0438\u0437 \u043e\u0447\u0435\u0440\u0435\u0434\u0438",operatorChange:"<img src='"+e.fn.vishnu.resourcesProvider.getBaseUrl(e.fn.vishnu._internalSettings.defaultBaseUrl)+"images/success.png'>\u0414\u0438\u0430\u043b\u043e\u0433 \u043f\u0435\u0440\u0435\u0434\u0430\u043d \u041e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u0443 %NAME.",operatorProcess:"<img src='"+e.fn.vishnu.resourcesProvider.getBaseUrl(e.fn.vishnu._internalSettings.defaultBaseUrl)+"images/circle_anim.gif'>\u0421\u043e\u0435\u0434\u0438\u043d\u044f\u044e \u0441 \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u043e\u043c",dialogEnd:"\u0414\u0438\u0430\u043b\u043e\u0433 \u0441 \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u043e\u043c \u0437\u0430\u0432\u0435\u0440\u0448\u0451\u043d.",file:"\u0417\u0430\u0433\u0440\u0443\u0436\u0435\u043d \u0444\u0430\u0439\u043b: %FILE",log:"\u0414\u043b\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0438\u0441\u0442\u043e\u0440\u0438\u0438 \u0434\u0438\u0430\u043b\u043e\u0433\u0430 \u043f\u0435\u0440\u0435\u0439\u0434\u0438\u0442\u0435 \u043f\u043e \u0441\u0441\u044b\u043b\u043a\u0435: %FILE"},savePrevTehMessage:!1,uploadEnable:!0,uploadPlugin:"uploadcare.min.js",idAttachFile:"",uploadcareId:"#vishnu-livechat-block",uploadcareTemplate:'<div id="vishnu-livechat-block"><div id="vishnu-livechat-off"><a href="#">\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433 \u0441 \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u043e\u043c</a></div><div id="vishnu-attach-file-container"><input id="vishnu-attach-file" name="screenshot" type="hidden" role="uploadcare-uploader" data-crop="" data-tabs="file" data-public-key="%UPLOADCARE_PUBLIC_KEY" /></div><div id="vishnu-save-log"></div></div>',uploadcare:null,uploadcareWidgets:null,showRateBeforeQuit:!0,templateRateForLiveChat:'<div id="vishnu-livechat-rate">\u0414\u0438\u0430\u043b\u043e\u0433 \u0437\u0430\u0432\u0435\u0440\u0448\u0451\u043d. \u041e\u0446\u0435\u043d\u0438\u0442\u0435 \u0440\u0430\u0431\u043e\u0442\u0443 \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u0430 \u043f\u043e 10-\u0431\u0430\u043b\u044c\u043d\u043e\u0439 \u0448\u043a\u0430\u043b\u0435.<div id="vishnu-livechat-rate-details"><a href="#" rel="0">0</a><a href="#" rel="1">1</a><a href="#" rel="2">2</a><a href="#" rel="3">3</a><a href="#" rel="4">4</a><a href="#" rel="5">5</a><a href="#" rel="6">6</a><a href="#" rel="7">7</a><a href="#" rel="8">8</a><a href="#" rel="9">9</a><a href="#" rel="10">10</a></div><textarea placeholder="\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043d\u0430\u043f\u0438\u0448\u0438\u0442\u0435, \u043f\u043e\u0447\u0435\u043c\u0443 \u0432\u044b \u043f\u043e\u0441\u0442\u0430\u0432\u0438\u043b\u0438 \u0438\u043c\u0435\u043d\u043d\u043e \u044d\u0442\u0443 \u043e\u0446\u0435\u043d\u043a\u0443"></textarea><button type="button" class="vishnu-livechat-rate-send">\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c</button><button type="button" class="vishnu-livechat-rate-cancel">\u041e\u0442\u043c\u0435\u043d\u0430</button><br clear="all"></div><div class="vishnu-empty-box"><p><br></p></div>',rateShown:!1,rateAnswered:!1,isInf:1,isInit:!1,isReady:!1,state:null,initAlreadySended:!1,init:function(e){for(var n in e)n in this&&(this[n]=e[n]);this.load(this.getScriptSource()),this.initEvents(),this.Vishnu.log("CSI: \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0439 \u043c\u043e\u0434\u0443\u043b\u044c \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d \u0438 \u0438\u043d\u0438\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d")},initEvents:function(){},setLiveChatDesign:function(n){var t=this.Vishnu.getView(),i=this;if(n){if(t.container.hasClass("vishnu-live-chat"))return;t.noCharacter=!0,t._stopAnimation(),t.container.addClass("vishnu-live-chat"),this.enabledUploadPlugin(),e("#vishnu-livechat-off > a",t.container).on("click",function(){i.debugIntergtaion&&console.log("\u0412\u042b\u0417\u0412\u0410\u041d\u041e:     "+e.fn.vishnu.VishnuEvent.USER_END_DIALOG),e(window).trigger(e.fn.vishnu.VishnuEvent.USER_END_DIALOG),e(window).trigger(e.fn.vishnu.VishnuEvent.RATE)}),e("#vishnu-save-log",t.container).on("click",function(){i.Vishnu.trigger(e.fn.vishnu.VishnuEvent.LOG_UPLOAD_EXTERNAL_PROCESS)})}else t.container.removeClass("vishnu-live-chat"),this.removeUploadPlugin(this.uploadcareId),t.noCharacter=!1,t._stopAnimation(),e("#vishnu-livechat-off > a",t.container).off("click"),e("#vishnu-save-log",t.container).off("click");t.updateHeight()},setOperatorAvatar:function(n){var t=this.Vishnu.getView();t._stopAnimation(),e(t.idView+"> img").length?e(t.idView+"> img").attr("src",n):e(t.idView).append('<img src="'+n+'" alt="" />')},setOperatorName:function(n){var t=this.Vishnu.getView();this.idOperatorName&&e(this.idOperatorName,t.container).length&&n&&e(this.idOperatorName,t.container).text(n)},removeUploadPlugin:function(n){var t=this.Vishnu.getView();e(n,t.container).length&&e(n,t.container).remove()},enabledUploadPlugin:function(){},onMessage:function(e){switch(this.lastMessage=e.message,this.messageCount++,e.kind){case this.KIND_VISITOR:this.onUserMessage(e);break;case this.KIND_OPERATOR:this.onPersonMessage(e),$history=this.Vishnu.getHistory(),$history.response({id:"from_CSI",text:{value:e.message}});break;default:this.onInfoMessage(e)}},onInfoMessage:function(e){$view=this.Vishnu.getView(),$history=this.Vishnu.getHistory(),$view.addTehMessage(e.message,10,this.savePrevTehMessage),this.saveTehMessage&&$history.tehno(e.message),this.savePrevTehMessage=!1},onUserMessage:function(e){$view=this.Vishnu.getView(),$view.addUserMessage(e.message,10,e.file?"html":"")},onPersonMessage:function(e){$view=this.Vishnu.getView(),$view.addInfMessage(e.message)},onLiveChatReady:function(e){this.isLiveChatReady||(this.isLiveChatReady=!0)},getScriptSource:function(n){var t=n||this.scriptEvAdapterLocation;return null!==t?e.fn.vishnu.resourcesProvider.getCorrectScriptUrl(t,this.baseUrl):null},load:function(e){if(null!==e){var n=document.createElement("script");n.type="text/javascript",n.charset="utf-8",n.src=e,document.getElementsByTagName("head")[0].appendChild(n)}}}}("undefined"!=typeof vishnuJQuery?vishnuJQuery:jQuery),function(e){var n=e.fn.vishnu.LCEModel.prototype.initEvents;e.fn.vishnu.LCEModel.prototype.initEvents=function(){n.apply(this,arguments);var t=this;this.Vishnu.on(e.fn.vishnu.VishnuEvent.REQUIRES_OPERATOR,function(e){t.sendRequiresOperator()})},e.fn.vishnu.LCEModel.prototype.sendRequiresOperator=function(n){this.debugIntergtaion&&console.log("\u041f\u0415\u0420\u0415\u0425\u0412\u0410\u0427\u0415\u041d\u041e: "+e.fn.vishnu.VishnuEvent.REQUIRES_OPERATOR),this.isLiveChatReady||this.onLiveChatReady(),this.debugIntergtaion&&console.log("\u0412\u042b\u0417\u0412\u0410\u041d\u041e:     "+e.fn.vishnu.VishnuEvent.SWITCH_TO_OPERATOR_REQUESTED),e(window).trigger(e.fn.vishnu.VishnuEvent.SWITCH_TO_OPERATOR_REQUESTED),this.onMessage({message:this.TEHmessage.operatorProcess}),this.sendLogWithRequiresOperator&&!this.sendLogWithLCSessionCreate&&this.Vishnu.trigger(e.fn.vishnu.VishnuEvent.V3G_LOG_TO_OPERATOR_SENT),this.queueTimeout&&null!==this.queueTimeout&&(this.queueTimer=window.setTimeout(function(){e(window).trigger(e.fn.vishnu.VishnuEvent.USER_END_DIALOG),e(window).trigger(e.fn.vishnu.VishnuEvent.QUEUE_TIMED_OUT)},this.queueTimeout)),this.debugIntergtaion&&setTimeout(function(){var n=Math.round(6*Math.random()-.5),t=n>0;e(window).trigger(e.fn.vishnu.VishnuEvent.LIVECHAT_STATUS_REQUESTED,{hasOnlineOperators:t,freeOperatorsCount:n})},this.debugIntergtaionTime)}}("undefined"!=typeof vishnuJQuery?vishnuJQuery:jQuery),function(e){var n=e.fn.vishnu.LCEModel.prototype.initEvents;e.fn.vishnu.LCEModel.prototype.initEvents=function(){n.apply(this,arguments);var t=this;this.Vishnu.on(e.fn.vishnu.VishnuEvent.MODE_CHANGE,function(e,n){t.modeChange(n)})},e.fn.vishnu.LCEModel.prototype.modeChange=function(n){n&&n.mode==e.fn.vishnu.VishnuModes.LIVE_CHAT&&this.Vishnu.trigger(e.fn.vishnu.VishnuEvent.REQUIRES_OPERATOR)}}("undefined"!=typeof vishnuJQuery?vishnuJQuery:jQuery),function(e){var n=e.fn.vishnu.LCEModel.prototype.initEvents;e.fn.vishnu.LCEModel.prototype.initEvents=function(){n.apply(this,arguments);var t=this;e(window).on(e.fn.vishnu.VishnuEvent.LIVECHAT_STATUS_REQUESTED,function(e,n){t.liveChatStatusRequested(n)})},e.fn.vishnu.LCEModel.prototype.liveChatStatusRequested=function(n){this.isLiveChatReady&&("string"==typeof n&&(n=JSON.parse(n)),this.debugIntergtaion&&console.log("\u041f\u0415\u0420\u0415\u0425\u0412\u0410\u0427\u0415\u041d\u041e: "+e.fn.vishnu.VishnuEvent.LIVECHAT_STATUS_REQUESTED+" DATA: ",n),!n||n.hasOnlineOperators&&0!==n.freeOperatorsCount?this.debugIntergtaion&&setTimeout(function(){e(window).trigger(e.fn.vishnu.VishnuEvent.OPERATOR_PERSON_ASSIGNED,{operatorId:123456,operatorAvatar:"./images/avatar.png",operatorName:"\u041e\u043f\u0435\u0440\u0430\u0442\u043e\u0440 (\u0442\u0435\u0441\u0442)",dialogId:654321})},this.debugIntergtaionTime):(this.onMessage({message:this.TEHmessage.noOperators}),this.savePrevTehMessage=!0,this.debugIntergtaion&&console.log("\u0412\u042b\u0417\u0412\u0410\u041d\u041e:     "+e.fn.vishnu.VishnuEvent.SWITCH_TO_VISHNU),e(window).trigger(e.fn.vishnu.VishnuEvent.SWITCH_TO_VISHNU,{status:"noOperators"})))}}("undefined"!=typeof vishnuJQuery?vishnuJQuery:jQuery),function(e){var n=e.fn.vishnu.LCEModel.prototype.initEvents;e.fn.vishnu.LCEModel.prototype.initEvents=function(){n.apply(this,arguments);var t=this;e(window).on(e.fn.vishnu.VishnuEvent.LIVECHAT_SESSION_CREATED,function(e){t.liveChatSessionCreated()})},e.fn.vishnu.LCEModel.prototype.liveChatSessionCreated=function(){this.debugIntergtaion&&console.log("\u041f\u0415\u0420\u0415\u0425\u0412\u0410\u0427\u0415\u041d\u041e: "+e.fn.vishnu.VishnuEvent.LIVECHAT_SESSION_CREATED),this.sendLogWithLCSessionCreate&&!this.sendLogWithRequiresOperator&&this.Vishnu.trigger(e.fn.vishnu.VishnuEvent.V3G_LOG_TO_OPERATOR_SENT)}}("undefined"!=typeof vishnuJQuery?vishnuJQuery:jQuery),function(e){var n=e.fn.vishnu.LCEModel.prototype.initEvents;e.fn.vishnu.LCEModel.prototype.initEvents=function(){n.apply(this,arguments);var t=this;t.Vishnu.on(e.fn.vishnu.VishnuEvent.V3G_LOG_TO_OPERATOR_SENT,function(e,n){t.logToOperatorSent(n)})},e.fn.vishnu.LCEModel.prototype.logToOperatorSent=function(n){this.debugIntergtaion&&console.log("\u041f\u0415\u0420\u0415\u0425\u0412\u0410\u0427\u0415\u041d\u041e: "+e.fn.vishnu.VishnuEvent.V3G_LOG_TO_OPERATOR_SENT+" DATA: ",n);var t;t=this.Vishnu.History.get(),this.debugIntergtaion&&console.log("\u0412\u042b\u0417\u0412\u0410\u041d\u041e:     "+e.fn.vishnu.VishnuEvent.LOG_TO_OPERATOR_SENT+" DATA: ",t),e(window).trigger(e.fn.vishnu.VishnuEvent.LOG_TO_OPERATOR_SENT,t)}}("undefined"!=typeof vishnuJQuery?vishnuJQuery:jQuery),function(e){var n=e.fn.vishnu.LCEModel.prototype.initEvents;e.fn.vishnu.LCEModel.prototype.initEvents=function(){n.apply(this,arguments);var t=this;e(window).on(e.fn.vishnu.VishnuEvent.QUEUE_TIMED_OUT,function(e){t.queueTimedOut()})},e.fn.vishnu.LCEModel.prototype.queueTimedOut=function(){this.isLiveChatReady&&(this.debugIntergtaion&&console.log("\u041f\u0415\u0420\u0415\u0425\u0412\u0410\u0427\u0415\u041d\u041e: "+e.fn.vishnu.VishnuEvent.QUEUE_TIMED_OUT),this.onMessage({message:this.TEHmessage.queueTime}),this.savePrevTehMessage=!0,this.debugIntergtaion&&console.log("\u0412\u042b\u0417\u0412\u0410\u041d\u041e:     "+e.fn.vishnu.VishnuEvent.SWITCH_TO_VISHNU),e(window).trigger(e.fn.vishnu.VishnuEvent.SWITCH_TO_VISHNU,{status:"queueTimeout"}))}}("undefined"!=typeof vishnuJQuery?vishnuJQuery:jQuery),function(e){var n=e.fn.vishnu.LCEModel.prototype.initEvents;e.fn.vishnu.LCEModel.prototype.initEvents=function(){n.apply(this,arguments);var t=this;e(window).on(e.fn.vishnu.VishnuEvent.OPERATOR_PERSON_ASSIGNED,function(e,n){t.operatorPersonAssigned(n)})},e.fn.vishnu.LCEModel.prototype.operatorPersonAssigned=function(n){this.isLiveChatReady&&(this.debugIntergtaion&&console.log("\u041f\u0415\u0420\u0415\u0425\u0412\u0410\u0427\u0415\u041d\u041e: "+e.fn.vishnu.VishnuEvent.OPERATOR_PERSON_ASSIGNED+" DATA: ",n),n&&(this.operatorId=n.operatorId?n.operatorId:null,this.operatorAvatar=n.operatorAvatar?n.operatorAvatar:null,this.operatorName=n.operatorName?n.operatorName:"\u041e\u043f\u0435\u0440\u0430\u0442\u043e\u0440",this.dialogId=n.dialogId?n.dialogId:null,this.restoreSession&&(e(window).trigger(e.fn.vishnu.VishnuEvent.SWITCH_TO_OPERATOR_SUCCESS),this.restoreSession=!1),this.debugIntergtaion&&setTimeout(function(){e(window).trigger(e.fn.vishnu.VishnuEvent.SWITCH_TO_OPERATOR_SUCCESS)},this.debugIntergtaionTime)))}}("undefined"!=typeof vishnuJQuery?vishnuJQuery:jQuery),function(e){var n=e.fn.vishnu.LCEModel.prototype.initEvents;e.fn.vishnu.LCEModel.prototype.initEvents=function(){n.apply(this,arguments);var t=this;e(window).on(e.fn.vishnu.VishnuEvent.SWITCH_TO_OPERATOR_SUCCESS,function(e){t.switchToOperatorSuccess()})},e.fn.vishnu.LCEModel.prototype.switchToOperatorSuccess=function(){this.isLiveChatReady&&(this.debugIntergtaion&&console.log("\u041f\u0415\u0420\u0415\u0425\u0412\u0410\u0427\u0415\u041d\u041e: "+e.fn.vishnu.VishnuEvent.SWITCH_TO_OPERATOR_SUCCESS),this.queueTimeout&&null!==this.queueTimeout&&null!==this.queueTimer&&(clearTimeout(this.queueTimer),this.queueTimer=null),this.transformDesignWidget&&(this.debugIntergtaion&&console.log("\u0421\u041e\u0425\u0420\u0410\u041d\u0415\u041d\u041d\u042b\u0415 \u0414\u0410\u041d\u041d\u042b\u0415 \u041e\u041f\u0415\u0420\u0410\u0422\u041e\u0420\u0410: ",this.operatorId,this.operatorAvatar,this.operatorName,this.dialogId),this.onMessage({message:this.TEHmessage.operatorChange.replace("%NAME",this.operatorName)}),this.setLiveChatDesign(!0),this.setOperatorAvatar(this.operatorAvatar),this.setOperatorName(this.operatorName)))}}("undefined"!=typeof vishnuJQuery?vishnuJQuery:jQuery),function(e){var n=e.fn.vishnu.LCEModel.prototype.initEvents;e.fn.vishnu.LCEModel.prototype.initEvents=function(){n.apply(this,arguments);var t=this;this.Vishnu.on(e.fn.vishnu.VishnuEvent.USER_ACTIVITY,function(e){t.userTyped()})},e.fn.vishnu.LCEModel.prototype.userTyped=function(){if(!this.rateShown&&this.isLiveChatReady){this.debugIntergtaion&&console.log("\u041f\u0415\u0420\u0415\u0425\u0412\u0410\u0427\u0415\u041d\u041e: "+e.fn.vishnu.VishnuEvent.USER_ACTIVITY);var n=this.Vishnu.getView(),t={ts:(new Date).getTime(),currentText:e(n.idInput).val()};this.debugIntergtaion&&console.log("\u0412\u042b\u0417\u0412\u0410\u041d\u041e:     "+e.fn.vishnu.VishnuEvent.USER_TYPED+" DATA: ",t),e(window).trigger(e.fn.vishnu.VishnuEvent.USER_TYPED,t)}}}("undefined"!=typeof vishnuJQuery?vishnuJQuery:jQuery),function(e){var n=e.fn.vishnu.LCEModel.prototype.initEvents;e.fn.vishnu.LCEModel.prototype.initEvents=function(){n.apply(this,arguments);var t=this;this.Vishnu.on(e.fn.vishnu.VishnuEvent.REQUEST,function(e,n){t.sendRequest(n)}),e(window).on(e.fn.vishnu.VishnuEvent.OPERATOR_TEXT_SENT,function(e,n){t.onResponse(n)})},e.fn.vishnu.LCEModel.prototype.sendRequest=function(n){if(!this.rateShown&&this.isLiveChatReady&&(this.debugIntergtaion&&console.log("\u041f\u0415\u0420\u0415\u0425\u0412\u0410\u0427\u0415\u041d\u041e: "+e.fn.vishnu.VishnuEvent.REQUEST+" DATA: ",n),n)){var t={kind:this.KIND_VISITOR,ts:(new Date).getTime(),message:n};this.debugIntergtaion&&console.log("\u0412\u042b\u0417\u0412\u0410\u041d\u041e:     "+e.fn.vishnu.VishnuEvent.USER_TEXT_SENT+" DATA: ",t),e(window).trigger(e.fn.vishnu.VishnuEvent.USER_TEXT_SENT,t),this.debugIntergtaion&&setTimeout(function(){e(window).trigger(e.fn.vishnu.VishnuEvent.OPERATOR_TYPED)},this.debugIntergtaionTime)}},e.fn.vishnu.LCEModel.prototype.onResponse=function(n){this.rateShown||this.isLiveChatReady&&(this.debugIntergtaion&&console.log("\u041f\u0415\u0420\u0415\u0425\u0412\u0410\u0427\u0415\u041d\u041e: "+e.fn.vishnu.VishnuEvent.OPERATOR_TEXT_SENT+" DATA: ",n),this.debugIntergtaion&&(n={kind:this.KIND_OPERATOR,ts:98765456,message:"\u0445\u0430\u0440\u0434\u043a\u043e\u0434: \u0422\u0435\u043a\u0441\u0442 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u0430",messageId:1234}),void 0!==n.kind&&""!==n.kind||(n.kind=this.KIND_OPERATOR),this.onMessage(n))}}("undefined"!=typeof vishnuJQuery?vishnuJQuery:jQuery),function(e){var n=e.fn.vishnu.LCEModel.prototype.initEvents;e.fn.vishnu.LCEModel.prototype.initEvents=function(){n.apply(this,arguments);var t=this;e(window).on(e.fn.vishnu.VishnuEvent.OPERATOR_TYPED,function(e){t.operatorTyped()})},e.fn.vishnu.LCEModel.prototype.operatorTyped=function(){if(this.isLiveChatReady){this.debugIntergtaion&&console.log("\u041f\u0415\u0420\u0415\u0425\u0412\u0410\u0427\u0415\u041d\u041e: "+e.fn.vishnu.VishnuEvent.OPERATOR_TYPED);this.debugIntergtaion&&setTimeout(function(){e(window).trigger(e.fn.vishnu.VishnuEvent.OPERATOR_TEXT_SENT)},this.debugIntergtaionTime)}}}("undefined"!=typeof vishnuJQuery?vishnuJQuery:jQuery),function(e){var n=e.fn.vishnu.LCEModel.prototype.initEvents;e.fn.vishnu.LCEModel.prototype.initEvents=function(){n.apply(this,arguments);var t=this;e(window).on(e.fn.vishnu.VishnuEvent.RATE,function(e,n){t.showRate()}),this.Vishnu.on(e.fn.vishnu.VishnuEvent.V3G_OPERATOR_CHAT_RATED,function(n,t){this.debugIntergtaion&&console.log("\u0412\u042b\u0417\u0412\u0410\u041d\u041e:     "+e.fn.vishnu.VishnuEvent.OPERATOR_CHAT_RATED+"DATA: ",t),e(window).trigger(e.fn.vishnu.VishnuEvent.OPERATOR_CHAT_RATED,t),e(window).trigger(e.fn.vishnu.VishnuEvent.SWITCH_TO_VISHNU,{status:"null"})})},e.fn.vishnu.LCEModel.prototype.showRate=function(){if(this.isLiveChatReady&&!this.rateShown){this.debugIntergtaion&&console.log("\u041f\u0415\u0420\u0415\u0425\u0412\u0410\u0427\u0415\u041d\u041e: "+e.fn.vishnu.VishnuEvent.RATE);var n=this;$view=this.Vishnu.getView(),this.rateShown=!0,this.rateAnswered=!1;var t=e($view.idResponseText,$view.container).data("jsp");t&&(t.getContentPane().append(e(n.templateRateForLiveChat)),$view.updateHeight()),this.Vishnu.track(["_trackEvent","Inf","Rate","Show"]),$view.updateHeight(),this.removeUploadPlugin(this.uploadcareId),e("#vishnu-livechat-rate",$view.container).on("click","#vishnu-livechat-rate-details > a",function(){e(this).parent().find("a").removeClass("selected"),e(this).addClass("selected")}),e("#vishnu-livechat-rate",$view.container).on("click",".vishnu-livechat-rate-send",function(){n.sendOperatorRate()}),e("#vishnu-livechat-rate",$view.container).on("click",".vishnu-livechat-rate-cancel",function(){n.removeRate()})}},e.fn.vishnu.LCEModel.prototype.sendOperatorRate=function(){if(this.isLiveChatReady&&!this.rateAnswered){var n=e("#vishnu-livechat-rate",$view.container).find("#vishnu-livechat-rate-details > a.selected").attr("rel"),t=n?parseInt(n):0,i=e("#vishnu-livechat-rate",$view.container).find("textarea").val();if(t>=0){this.rateAnswered=!0;var s={dialogId:this.dialogId,operatorId:this.operatorId,rating:t,message:i};this.debugIntergtaion&&console.log("\u0412\u042b\u0417\u0412\u0410\u041d\u041e:     "+e.fn.vishnu.VishnuEvent.V3G_OPERATOR_CHAT_RATED+" DATA: ",s),this.Vishnu.trigger(e.fn.vishnu.VishnuEvent.V3G_OPERATOR_CHAT_RATED,s),this.removeRate()}}},e.fn.vishnu.LCEModel.prototype.removeRate=function(){$view=this.Vishnu.getView(),this.rateShown=!1,this.rateAnswered=!1,e("#vishnu-livechat-rate",$view.container).remove(),$view.updateHeight(),e(window).trigger(e.fn.vishnu.VishnuEvent.SWITCH_TO_VISHNU,{status:"rateIsHidden"})}}("undefined"!=typeof vishnuJQuery?vishnuJQuery:jQuery),function(e){var n=e.fn.vishnu.LCEModel.prototype.initEvents;e.fn.vishnu.LCEModel.prototype.initEvents=function(){n.apply(this,arguments);var t=this;this.Vishnu.on(e.fn.vishnu.VishnuEvent.V3G_UPLOAD_EXTERNAL_PROCESS,function(n){this.debugIntergtaion&&(console.log("\u041f\u0415\u0420\u0415\u0425\u0412\u0410\u0427\u0415\u041d\u041e: "+e.fn.vishnu.VishnuEvent.V3G_UPLOAD_EXTERNAL_PROCESS),console.log("\u0412\u042b\u0417\u0412\u0410\u041d\u041e:     "+e.fn.vishnu.VishnuEvent.LOG_UPLOAD_EXTERNAL_PROCESS)),e(window).trigger(e.fn.vishnu.VishnuEvent.LOG_UPLOAD_EXTERNAL_PROCESS)}),e(window).on(e.fn.vishnu.VishnuEvent.LOG_UPLOADED,function(n,i){this.debugIntergtaion&&console.log("\u041f\u0415\u0420\u0415\u0425\u0412\u0410\u0427\u0415\u041d\u041e: "+e.fn.vishnu.VishnuEvent.LOG_UPLOADED),t.successUpload(i,"log")})}}("undefined"!=typeof vishnuJQuery?vishnuJQuery:jQuery),function(e){var n=e.fn.vishnu.LCEModel.prototype.initEvents;e.fn.vishnu.LCEModel.prototype.initEvents=function(){n.apply(this,arguments);var t=this;e(window).on(e.fn.vishnu.VishnuEvent.FILE_UPLOAD_EXTERNAL_PROCESS,function(n){this.debugIntergtaion&&console.log("\u041f\u0415\u0420\u0415\u0425\u0412\u0410\u0427\u0415\u041d\u041e: "+e.fn.vishnu.VishnuEvent.FILE_UPLOAD_EXTERNAL_PROCESS)}),e(window).on(e.fn.vishnu.VishnuEvent.FILE_UPLOADED,function(e,n){t.successUpload(n)})},e.fn.vishnu.LCEModel.prototype.enabledUploadPlugin=function(){if(this.uploadEnable){"undefined"==typeof UPLOADCARE_LOCALE&&(UPLOADCARE_LOCALE="ru"),"undefined"==typeof UPLOADCARE_AUTOSTORE&&(UPLOADCARE_AUTOSTORE=!0),"undefined"==typeof UPLOADCARE_PUBLIC_KEY&&(UPLOADCARE_PUBLIC_KEY="abc7eba1605e716be691"),this.load(this.getScriptSource(this.uploadPlugin)),$view=this.Vishnu.getView();$view.idRequest&&e($view.idRequest).before(this.uploadcareTemplate.replace("%UPLOADCARE_PUBLIC_KEY",UPLOADCARE_PUBLIC_KEY));var n=setInterval(function(){if("undefined"!=typeof uploadcare&&(clearInterval(n),!this.uploadcareWidgets)){this.uploadcareWidgets=uploadcare.initialize();var t=this.uploadcareWidgets;e("body").on("click",function(n){if(e(n.target).hasClass("uploadcare-widget-button-open")&&e(window).trigger(e.fn.vishnu.VishnuEvent.FILE_UPLOAD_EXTERNAL_PROCESS),e(n.target).hasClass("uploadcare-dialog-button-success")&&!e(n.target).hasClass("uploadcare-disabled-el")){if(e("[name='screenshot']",".vishnu-container").length){var i=e("[name='screenshot']",".vishnu-container").attr("value"),s={status:!0,fileName:e(".uploadcare-widget-file-name.uploadcare-link").text(),fileType:"image",fileUrl:i,fileTTL:null};e(window).trigger(e.fn.vishnu.VishnuEvent.FILE_UPLOADED,s)}t&&t[0]&&t[0].value(null)}})}},100)}},e.fn.vishnu.LCEModel.prototype.successUpload=function(n,t,i){this.debugIntergtaion&&console.log("\u041f\u0415\u0420\u0415\u0425\u0412\u0410\u0427\u0415\u041d\u041e: "+e.fn.vishnu.VishnuEvent.FILE_UPLOADED+" DATA: ",n);var s='<a href="'+(n.fileUrl+(n.fileName?n.fileName:""))+'" target="_blank">'+(n.fileName?n.fileName:"\u0441\u043a\u0430\u0447\u0430\u0442\u044c \u0444\u0430\u0439\u043b")+"</a>";t=void 0===t?"file":t,n={kind:void 0===i?this.KIND_VISITOR:this[i],ts:(new Date).getTime(),message:this.TEHmessage[t].replace("%FILE",s),messageId:1234,file:!0},this.onMessage(n)}}("undefined"!=typeof vishnuJQuery?vishnuJQuery:jQuery),function(e){var n=e.fn.vishnu.LCEModel.prototype.initEvents;e.fn.vishnu.LCEModel.prototype.initEvents=function(){n.apply(this,arguments);var t=this;e(window).on(e.fn.vishnu.VishnuEvent.FORM_SHOW,function(e,n){t.showForm(n)})},e.fn.vishnu.LCEModel.prototype.showForm=function(n){if(this.isLiveChatReady&&n){this.debugIntergtaion&&console.log("\u041f\u0415\u0420\u0415\u0425\u0412\u0410\u0427\u0415\u041d\u041e: "+e.fn.vishnu.VishnuEvent.FORM_SHOW+" DATA: ",n);var t={kind:this.KIND_OPERATOR,ts:(new Date).getTime(),message:n};this.onMessage(t)}}}("undefined"!=typeof vishnuJQuery?vishnuJQuery:jQuery),function(e){var n=e.fn.vishnu.LCEModel.prototype.initEvents;e.fn.vishnu.LCEModel.prototype.initEvents=function(){n.apply(this,arguments);var t=this;e(window).on(e.fn.vishnu.VishnuEvent.SWITCH_TO_VISHNU,function(n,i){if(void 0!==i&&void 0!==i.status&&("operatorEnd"===i.status||"timeout"===i.status)&&t.showRateBeforeQuit)return e(window).trigger(e.fn.vishnu.VishnuEvent.RATE),!1;t.returnToVishnu(i)})},e.fn.vishnu.LCEModel.prototype.returnToVishnu=function(n){this.rateShown||this.isLiveChatReady&&(this.debugIntergtaion&&console.log("\u041f\u0415\u0420\u0415\u0425\u0412\u0410\u0427\u0415\u041d\u041e: "+e.fn.vishnu.VishnuEvent.SWITCH_TO_VISHNU+" DATA: ",n),$model=this.Vishnu.getModel(),$model.mode(e.fn.vishnu.VishnuModes.INF),this.isLiveChatReady=!1,this.onMessage({message:this.TEHmessage.dialogEnd}),this.savePrevTehMessage=!0,this.setLiveChatDesign(!1),this.onMessage({message:this.TEHmessage.operatorChange.replace("%NAME","\u0418\u041d\u0424")}))}}("undefined"!=typeof vishnuJQuery?vishnuJQuery:jQuery),function(e){var n=e.fn.vishnu.LCEModel.prototype.load;e.fn.vishnu.LCEModel.prototype.load=function(e){window.adapterAlreadyLoad,n.apply(this,arguments),window.adapterAlreadyLoad=!0},e.fn.vishnu.LCEModel.prototype.switchToOperatorSuccess=function(){this.isLiveChatReady&&(this.debugIntergtaion&&console.log("\u041f\u0415\u0420\u0415\u0425\u0412\u0410\u0427\u0415\u041d\u041e: "+e.fn.vishnu.VishnuEvent.SWITCH_TO_OPERATOR_SUCCESS),this.queueTimeout&&null!==this.queueTimeout&&null!==this.queueTimer&&(clearTimeout(this.queueTimer),this.queueTimer=null),this.transformDesignWidget&&(this.debugIntergtaion&&console.log("\u0421\u041e\u0425\u0420\u0410\u041d\u0415\u041d\u041d\u042b\u0415 \u0414\u0410\u041d\u041d\u042b\u0415 \u041e\u041f\u0415\u0420\u0410\u0422\u041e\u0420\u0410: ",this.operatorId,this.operatorAvatar,this.operatorName,this.dialogId),this.onMessage({message:this.TEHmessage.operatorChange.replace("%NAME",this.operatorName)}),this.setLiveChatDesign(!0)))},e.fn.vishnu.LCEModel.prototype.setLiveChatDesign=function(n){var t=this.Vishnu.getView(),i=this;if(n){if(t.container.hasClass("vishnu-live-chat"))return;t.container.addClass("vishnu-live-chat"),this.setOperatorAvatar(e.fn.vishnu.resourcesProvider.getBaseUrl(e.fn.vishnu._internalSettings.defaultBaseUrl)+"images/avatar.png"),this.enabledUploadPlugin(),e("#vishnu-livechat-off > a",t.container).on("click",function(){i.debugIntergtaion&&console.log("\u0412\u042b\u0417\u0412\u0410\u041d\u041e:     "+e.fn.vishnu.VishnuEvent.USER_END_DIALOG),e(window).trigger(e.fn.vishnu.VishnuEvent.USER_END_DIALOG),e(window).trigger(e.fn.vishnu.VishnuEvent.RATE)}),e("#vishnu-save-log",t.container).on("click",function(){i.Vishnu.trigger(e.fn.vishnu.VishnuEvent.LOG_UPLOAD_EXTERNAL_PROCESS)})}else t.container.removeClass("vishnu-live-chat"),this.removeUploadPlugin(this.uploadcareId),t.noCharacter||(t._stopAnimation(),t._playAnimation(0)),e("#vishnu-livechat-off > a",t.container).off("click"),e("#vishnu-save-log",t.container).off("click");t.updateHeight()},e.fn.vishnu.LCEModel.prototype.returnToVishnu=function(n){if(!this.rateShown&&this.isLiveChatReady){console.log("\u041f\u0415\u0420\u0415\u0425\u0412\u0410\u0427\u0415\u041d\u041e: "+e.fn.vishnu.VishnuEvent.SWITCH_TO_VISHNU+" DATA: ",n),$model=this.Vishnu.getModel(),$model.mode(e.fn.vishnu.VishnuModes.INF),this.isLiveChatReady=!1;var t=this.operatorName?this.operatorName:"";"queueTimeout"!==n&&(this.onMessage({message:this.TEHmessage.dialogEnd.replace("%NAME",t)}),this.savePrevTehMessage=!0),this.onMessage({message:this.TEHmessage.operatorChange.replace("%NAME","\u0418\u041d\u0424")}),this.setLiveChatDesign(!1)}},e.fn.vishnu.LCEModel.prototype.liveChatStatusRequested=function(n){"string"==typeof n&&(n=JSON.parse(n)),console.log("\u041f\u0415\u0420\u0415\u0425\u0412\u0410\u0427\u0415\u041d\u041e: "+e.fn.vishnu.VishnuEvent.LIVECHAT_STATUS_REQUESTED+" DATA: ",n),!n||n.hasOnlineOperators&&0!==n.freeOperatorsCount?this.debugIntergtaion&&setTimeout(function(){e(window).trigger(e.fn.vishnu.VishnuEvent.OPERATOR_PERSON_ASSIGNED,{operatorId:123456,operatorAvatar:"../images/avatar.png",operatorName:"\u0423\u0430\u0441\u0401\u043a",dialogId:654321})},this.debugIntergtaionTime):(this.onMessage({message:this.TEHmessage.noOperators}),this.savePrevTehMessage=!0,console.log("\u0412\u042b\u0417\u0412\u0410\u041d\u041e:     "+e.fn.vishnu.VishnuEvent.SWITCH_TO_VISHNU),e(window).trigger(e.fn.vishnu.VishnuEvent.SWITCH_TO_VISHNU,{status:"noOperators"}))},e.fn.vishnu.LCEModel.prototype.setOperatorAvatar=function(n){var t=this.Vishnu.getView();t._stopAnimation(),e(t.idView+"> img").length?e(t.idView+"> img").attr("src",n):e(t.idView).append('<img src="'+n+'" alt="" />')};var t=e.fn.vishnu.LCEModel.prototype.initEvents;e.fn.vishnu.LCEModel.prototype.initEvents=function(){t.apply(this,arguments);var n=this;this.Vishnu.getView();(this.Vishnu.Target||e(window)).on("dop_operatorData",function(t,i){n.operatorId=i.operatorId?i.operatorId:null,n.operatorAvatar=i.operatorAvatar?i.operatorAvatar:e.fn.vishnu.resourcesProvider.getBaseUrl(e.fn.vishnu._internalSettings.defaultBaseUrl)+"images/avatar.png",n.operatorName=i.operatorName?i.operatorName:"\u041e\u043f\u0435\u0440\u0430\u0442\u043e\u0440",n.dialogId=i.dialogId?i.dialogId:null,n.setOperatorName(n.operatorName,!0),n.setOperatorAvatar(n.operatorAvatar),n.onMessage({message:n.TEHmessage.operatorChange.replace("%NAME",n.operatorName)})});var i=this.Vishnu.getModel();this.Vishnu.on(e.fn.vishnu.VishnuEvent.REQUIRES_OPERATOR,function(n){void 0!==i.Event.CHAT_STATE&&i.sendEvent(i.Event.CHAT_STATE,{status:e.fn.vishnu.ChatStatus.process})}),e(window).on(e.fn.vishnu.VishnuEvent.SWITCH_TO_OPERATOR_SUCCESS,function(n){void 0!==i.Event.CHAT_STATE&&i.sendEvent(i.Event.CHAT_STATE,{status:e.fn.vishnu.ChatStatus.success})}),e(window).on(e.fn.vishnu.VishnuEvent.USER_END_DIALOG,function(n,t){void 0!==i.Event.CHAT_STATE&&t&&i.sendEvent(i.Event.CHAT_STATE,{status:e.fn.vishnu.ChatStatus.userEnd})}),e(window).on(e.fn.vishnu.VishnuEvent.SWITCH_TO_VISHNU,function(n,t){if(void 0!==e.fn.vishnu.ChatStatus){var s;switch(t.status){case"operatorEnd":s={status:e.fn.vishnu.ChatStatus.operatorEnd};break;case"queueTimeout":case"noOperators":s={status:e.fn.vishnu.ChatStatus.queue}}"object"==typeof s&&void 0!==i.Event.CHAT_STATE&&i.sendEvent(i.Event.CHAT_STATE,s)}})}}("undefined"!=typeof vishnuJQuery?vishnuJQuery:jQuery),function(e){e.fn.vishnu.LCEModel.prototype.returnToVishnu=function(n){if(!this.rateShown&&this.isLiveChatReady){console.log("\u041f\u0415\u0420\u0415\u0425\u0412\u0410\u0427\u0415\u041d\u041e: "+e.fn.vishnu.VishnuEvent.SWITCH_TO_VISHNU+" DATA: ",n),$model=this.Vishnu.getModel(),$model.mode(e.fn.vishnu.VishnuModes.INF),this.isLiveChatReady=!1;var t=this.operatorName?this.operatorName:"";"queueTimeout"!==n.status&&(this.onMessage({message:this.TEHmessage.dialogEnd.replace("%NAME",t)}),this.savePrevTehMessage=!0),this.onMessage({message:this.TEHmessage.operatorChange.replace("%NAME","\u0418\u041d\u0424")}),this.setLiveChatDesign(!1)}}}("undefined"!=typeof vishnuJQuery?vishnuJQuery:jQuery);